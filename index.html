<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculateur de baies non protégées (CNB)</title>
<style>
    body { font-family: Arial, sans-serif; margin: 20px; background-color: #fff7f2; }
    #app { max-width: 800px; margin: 0 auto; padding: 20px; background-color: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); }
    h1 { color: #6d4c41; text-align: center; }
    .tab-nav { overflow: hidden; background-color: #ffece1; border-bottom: 1px solid #e6d7ce; }
    .tab-nav button { background-color: inherit; float: left; border: none; outline: none; cursor: pointer; padding: 14px 16px; transition: 0.3s; font-size: 16px; }
    .tab-nav button:hover { background-color: #ffddc9; }
    .tab-nav button.active { background-color: #bf755f; color: white; }
    .tab-content { display: none; padding: 20px; border: 1px solid #e6d7ce; border-top: none; }
    .tab-content.active { display: block; }
    .form-group { margin-bottom: 15px; }
    label { display: block; margin: 10px 0; font-size: 16px; }
    input[type="number"], select { width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #e6d7ce; border-radius: 4px; box-sizing: border-box; background-color: #fff7f2; }
    button { margin: 10px 0; padding: 10px 20px; background-color: #bf755f; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; }
    button:hover { background-color: #a05a46; }
    .results { background-color: #fff2e8; padding: 20px; border-radius: 8px; margin-top: 20px; border: 1px solid #e6d7ce; }
    .info { font-style: italic; font-size: 14px; color: #8d6e63; margin-top: 5px; }
.panel-header {
    position: relative;
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.duplicate-btn {
    background-color: #bf755f;
    color: white;
    border: none;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    font-size: 18px;
    cursor: pointer;
    position: absolute;
    right: 0;
    top: 10px;
}
.panels-container {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
}
.panel {
    flex: 1;
    min-width: 300px;
}
.panel-title {
    color: #6d4c41;
    margin: 10px 0;
    text-align: center;
}</style>
</head>
<body>
    <div id="app">
    <div class="panel-header">
        <h1>Calculateur de baies non protégées (CNB)</h1>
        <button class="duplicate-btn" onclick="duplicatePanel()">+</button>
    </div>
    <h2 style="text-align: center; color: #6d4c41; margin-top: 5px; margin-bottom: 20px;">Élévation avant</h2>
    
    <div class="panels-container">
        <div id="panel-1" class="panel">
            <h3 class="panel-title">Façade de rayonnement #1</h3>
            <div class="tab-nav">
        <div class="tab-nav">
            <button class="tab-link active" onclick="openTab(event, 'cnb')">Méthode CNB (3.2.3.)</button>
            <button class="tab-link" onclick="openTab(event, 'method91014')">Méthode 9.10.14</button>
            <button class="tab-link" onclick="openTab(event, 'method91015')">Méthode 9.10.15</button>
        </div>

        <!-- Onglet Méthode CNB (3.2.3.) -->
        <div id="cnb" class="tab-content active">
            <p>Calcul basé sur la section 3.2.3 du CNB</p>
            <div class="form-group">
                <label for="usage_cnb">Usage du bâtiment</label>
                <select id="usage_cnb">
                    <option value="groupes_A_B3_C_D_F3">Usages des groupes A, B division 3, C, D et F division 3</option>
                    <option value="groupes_E_F1_F2">Usages des groupes E et F divisions 1 et 2</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="construction_type_cnb">Type de construction</label>
                <select id="construction_type_cnb">
                    <option value="incombustible">Incombustible</option>
                    <option value="combustible">Combustible</option>
                </select>
                <div class="info">Selon 3.2.3.7, le type de construction a un impact sur les exigences.</div>
            </div>
            
            <div class="form-group">
                <label for="revetement_type_cnb">Type de revêtement</label>
                <select id="revetement_type_cnb">
                    <option value="incombustible">Incombustible</option>
                    <option value="combustible">Combustible</option>
                </select>
            </div>
            
            <div class="form-group">
                <label><input type="checkbox" id="sprinklers_cnb"> Bâtiment entièrement protégé par gicleurs</label>
            </div>
            
            <div class="form-group">
                <label for="distance_cnb">Distance limitative (m)</label>
                <input type="number" id="distance_cnb" value="5" min="0" step="0.1">
            </div>
            
            <div class="form-group">
                <label for="surface_cnb">Surface de la façade de rayonnement (m²)</label>
                <input type="number" id="surface_cnb" value="120" min="0">
            </div>
            
            <div class="form-group">
                <label for="length_cnb">Longueur de la façade (m)</label>
                <input type="number" id="length_cnb" value="20" min="0">
            </div>
            
            <div class="form-group">
                <label for="height_cnb">Hauteur de la façade (m)</label>
                <input type="number" id="height_cnb" value="6" min="0">
            </div>
            
            <div class="form-group">
                <label><input type="checkbox" id="glass_brick_cnb"> Baies protégées par briques de verre/verre armé</label>
                <div class="info">Selon 3.2.3.12, permet de doubler la surface maximale autorisée.</div>
            </div>
            
            <div class="form-group">
                <label><input type="checkbox" id="response_cnb"> Plus de 10 min dans 10 % ou plus des cas</label>
                <div class="info">Si coché, la distance limitative est divisée par 2 (selon le paragraphe 3.2.3.1. 8))</div>
            </div>
            
            <button onclick="calculateCNB()">Calculer</button>
            <div id="cnb-result" class="results"></div>
        </div>

        <!-- Onglet Méthode 9.10.14 -->
        <div id="method91014" class="tab-content">
            <p>Calcul basé sur la sous-section 9.10.14 du CNB (Tableau 9.10.14.4-A)</p>
            <div class="form-group">
                <label for="usage_91014">Usage du bâtiment</label>
                <select id="usage_91014">
                    <option value="habitation">Habitation, établissement d'affaires et établissement industriel à risques faibles</option>
                    <option value="commercial">Établissement commercial et établissement industriel à risques moyens</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="building_type_91014">Type de bâtiment</label>
                <select id="building_type_91014">
                    <option value="standard">Bâtiment standard</option>
                    <option value="garage">Garage ou bâtiment secondaire</option>
                </select>
                <div class="info">Les garages et bâtiments secondaires peuvent bénéficier d'exemptions selon 9.10.14.4(10-12) et 9.10.14.5(4-5).</div>
            </div>
            
            <div class="form-group">
                <label for="distance_91014">Distance limitative (m)</label>
                <input type="number" id="distance_91014" value="2.0" min="0" step="0.1">
            </div>
            
            <div class="form-group">
                <label for="surface_91014">Surface de la façade de rayonnement (m²)</label>
                <input type="number" id="surface_91014" value="30" min="0">
            </div>
            
            <div class="form-group">
                <label for="exterior_finish_91014">Type de revêtement extérieur</label>
                <select id="exterior_finish_91014">
                    <option value="combustible">Combustible</option>
                    <option value="incombustible">Incombustible</option>
                </select>
                <div class="info">Le type de revêtement est important pour les distances limitatives inférieures à 1,2 m.</div>
            </div>
            
            <div class="form-group">
                <label><input type="checkbox" id="soffit_protection_91014"> Soffites protégés</label>
                <div class="info">Concerne les soffites faisant saillie à moins de 1,2 m de la limite de propriété (9.10.14.5).</div>
            </div>
            
            <div class="form-group">
                <label><input type="checkbox" id="response_91014"> Plus de 10 min dans 10 % ou plus des cas</label>
                <div class="info">Si coché, la distance limitative est divisée par 2 (selon le paragraphe 9.10.14.3. 1))</div>
            </div>
            
            <button onclick="calculate91014()">Calculer</button>
            <div id="method91014-result" class="results"></div>
        </div>

        <!-- Onglet Méthode 9.10.15 -->
        <div id="method91015" class="tab-content">
            <p>Calcul basé sur la sous-section 9.10.15 du CNB (Tableau 9.10.15.4) - Pour habitations</p>
            <div class="info">Cette méthode s'applique uniquement aux bâtiments qui ne renferment que des logements et dont aucun des logements n'est situé au-dessus d'un autre logement.</div>
            
            <div class="form-group">
                <label for="housing_type_91015">Type d'habitation</label>
                <select id="housing_type_91015">
                    <option value="standard">Habitation standard</option>
                    <option value="accessoire">Maison comportant un logement accessoire</option>
                </select>
                <div class="info">Selon 9.10.15.1., les maisons comportant un logement accessoire suivent des règles spécifiques.</div>
            </div>
            
            <div class="form-group">
                <label for="distance_91015">Distance limitative (m)</label>
                <input type="number" id="distance_91015" value="2.0" min="0" step="0.1">
            </div>
            
            <div class="form-group">
                <label for="surface_91015">Surface de la façade de rayonnement (m²)</label>
                <input type="number" id="surface_91015" value="50" min="0">
            </div>
            
            <div class="form-group">
                <label for="reveting_type_91015">Type de revêtement extérieur</label>
                <select id="reveting_type_91015">
                    <option value="combustible">Combustible</option>
                    <option value="incombustible">Incombustible</option>
                </select>
                <div class="info">Selon 9.10.15.5, le type de revêtement a un impact sur les exigences de construction.</div>
            </div>
            
            <div class="form-group">
                <label><input type="checkbox" id="response_91015"> Plus de 10 min dans 10 % ou plus des cas</label>
                <div class="info">Si coché, la distance limitative est divisée par 2 (selon le paragraphe 9.10.15.3. 1))</div>
            </div>
            
            <button onclick="calculate91015()">Calculer</button>
            <div id="method91015-result" class="results"></div>
        </div>
        </div> <!-- Fermeture de panel-1 -->
    </div> <!-- Fermeture de panels-container -->
</div>
    <script>
        // Tableau 3.2.3.1.-B - Usages des groupes A, B3, C, D et F3 - Sans gicleurs
        const tableauGroupesAB3CDF3 = {
            10: {
                "< 3:1": [0, 8, 10, 18, 29, 46, 91, 100],
                "3:1 à 10:1": [0, 8, 12, 21, 33, 50, 96, 100],
                "> 10:1": [0, 11, 18, 32, 48, 68, 100]
            },
            15: {
                "< 3:1": [0, 7, 9, 14, 22, 33, 63, 100],
                "3:1 à 10:1": [0, 8, 10, 17, 25, 37, 67, 100],
                "> 10:1": [0, 10, 15, 26, 39, 53, 87, 100]
            },
            20: {
                "< 3:1": [0, 7, 9, 12, 18, 26, 49, 81, 100],
                "3:1 à 10:1": [0, 8, 10, 15, 21, 30, 53, 85, 100],
                "> 10:1": [0, 9, 14, 23, 33, 45, 72, 100]
            },
            25: {
                "< 3:1": [0, 7, 8, 11, 16, 23, 41, 66, 98, 100],
                "3:1 à 10:1": [0, 8, 9, 13, 19, 26, 45, 70, 100],
                "> 10:1": [0, 9, 13, 21, 30, 39, 62, 90, 100]
            },
            30: {
                "< 3:1": [0, 7, 8, 11, 15, 20, 35, 56, 83, 100],
                "3:1 à 10:1": [0, 7, 9, 12, 17, 23, 39, 61, 88, 100],
                "> 10:1": [0, 8, 12, 19, 27, 36, 56, 79, 100]
            },
            40: {
                "< 3:1": [0, 7, 8, 10, 13, 17, 28, 44, 64, 89, 100],
                "3:1 à 10:1": [0, 7, 8, 11, 15, 20, 32, 48, 69, 93, 100],
                "> 10:1": [0, 8, 11, 17, 24, 31, 47, 66, 88, 100]
            },
            50: {
                "< 3:1": [0, 7, 8, 9, 12, 15, 24, 37, 53, 72, 96, 100],
                "3:1 à 10:1": [0, 7, 8, 10, 14, 18, 28, 41, 57, 77, 100],
                "> 10:1": [0, 8, 10, 15, 21, 28, 41, 57, 76, 97, 100]
            },
            60: {
                "< 3:1": [0, 7, 8, 9, 11, 14, 21, 32, 45, 62, 81, 100],
                "3:1 à 10:1": [0, 7, 8, 10, 13, 16, 25, 36, 49, 66, 85, 100],
                "> 10:1": [0, 8, 10, 14, 20, 25, 38, 51, 67, 85, 100]
            },
            80: {
                "< 3:1": [0, 7, 7, 8, 10, 12, 18, 26, 36, 48, 62, 79, 98, 100],
                "3:1 à 10:1": [0, 7, 8, 9, 11, 14, 21, 29, 40, 52, 67, 84, 100],
                "> 10:1": [0, 8, 9, 13, 17, 22, 32, 44, 56, 70, 86, 100]
            },
            100: {
                "< 3:1": [0, 7, 7, 8, 9, 11, 16, 22, 30, 40, 51, 65, 80, 97, 100],
                "3:1 à 10:1": [0, 7, 8, 9, 11, 13, 18, 25, 34, 44, 56, 69, 84, 100],
                "> 10:1": [0, 7, 9, 12, 16, 20, 29, 39, 49, 61, 74, 89, 100]
            },
            150: {
                "< 3:1": [0, 7, 7, 8, 9, 10, 13, 17, 22, 29, 37, 46, 56, 67, 79, 93, 100],
                "3:1 à 10:1": [0, 7, 7, 8, 10, 11, 15, 20, 26, 33, 41, 50, 60, 71, 84, 97, 100],
                "> 10:1": [0, 7, 8, 11, 13, 17, 24, 31, 39, 48, 57, 68, 79, 91, 100]
            },
            250: {
                "< 3:1": [0, 7, 7, 7, 8, 9, 10, 13, 16, 20, 25, 30, 36, 43, 51, 59, 68, 87, 100],
                "3:1 à 10:1": [0, 7, 7, 8, 9, 10, 12, 15, 19, 24, 28, 34, 40, 47, 55, 63, 72, 92, 100],
                "> 10:1": [0, 7, 8, 9, 11, 14, 19, 24, 30, 36, 43, 50, 57, 65, 73, 82, 92, 100]
            },
            350: {
                "< 3:1": [0, 7, 7, 7, 8, 8, 9, 11, 14, 16, 20, 24, 28, 33, 38, 44, 50, 64, 81, 99, 100],
                "3:1 à 10:1": [0, 7, 7, 8, 8, 9, 11, 13, 16, 19, 23, 27, 32, 37, 42, 48, 55, 69, 85, 100],
                "> 10:1": [0, 7, 8, 9, 10, 12, 16, 21, 25, 30, 36, 41, 47, 53, 59, 66, 73, 88, 100]
            },
            500: {
                "< 3:1": [0, 7, 7, 7, 7, 8, 9, 10, 12, 14, 16, 19, 22, 25, 29, 33, 37, 47, 59, 71, 100],
                "3:1 à 10:1": [0, 7, 7, 7, 8, 8, 10, 12, 14, 16, 19, 22, 25, 29, 33, 37, 41, 52, 63, 76, 100],
                "> 10:1": [0, 7, 7, 8, 9, 11, 14, 18, 22, 25, 30, 34, 38, 43, 48, 53, 58, 70, 82, 96, 100]
            },
            1000: {
                "< 3:1": [0, 7, 7, 7, 7, 7, 8, 9, 9, 10, 12, 13, 14, 16, 18, 20, 22, 27, 33, 39, 58, 82, 100],
                "3:1 à 10:1": [0, 7, 7, 7, 7, 8, 9, 10, 11, 12, 14, 15, 17, 19, 21, 23, 26, 31, 37, 43, 63, 86, 100],
                "> 10:1": [0, 7, 7, 8, 8, 9, 11, 13, 16, 19, 21, 24, 27, 30, 33, 36, 39, 46, 53, 60, 82, 100]
            },
            2000: {
                "< 3:1": [0, 7, 7, 7, 7, 7, 7, 8, 8, 9, 9, 10, 11, 12, 13, 14, 15, 17, 20, 23, 33, 44, 58, 74, 93, 100],
                "3:1 à 10:1": [0, 7, 7, 7, 7, 7, 8, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 20, 23, 27, 37, 49, 63, 79, 97, 100],
                "> 10:1": [0, 7, 7, 7, 8, 8, 9, 11, 12, 14, 16, 18, 19, 21, 23, 25, 27, 32, 36, 40, 53, 66, 82, 99, 100]
            }
        };
        
        // Tableau 3.2.3.1.-C - Usages des groupes E, F1 et F2 - Sans gicleurs
        const tableauGroupesEF1F2 = {
            10: {
                "< 3:1": [0, 4, 5, 9, 15, 23, 46, 77, 100],
                "3:1 à 10:1": [0, 4, 6, 10, 17, 25, 48, 79, 100],
                "> 10:1": [0, 5, 9, 16, 24, 34, 58, 91, 100]
            },
            15: {
                "< 3:1": [0, 4, 5, 7, 11, 16, 32, 53, 79, 100],
                "3:1 à 10:1": [0, 4, 5, 8, 13, 18, 34, 55, 82, 100],
                "> 10:1": [0, 5, 8, 13, 19, 26, 43, 66, 93, 100]
            },
            20: {
                "< 3:1": [0, 4, 4, 6, 9, 13, 25, 40, 61, 85, 100],
                "3:1 à 10:1": [0, 4, 5, 7, 11, 15, 27, 43, 63, 87, 100],
                "> 10:1": [0, 5, 7, 11, 17, 22, 36, 53, 74, 99, 100]
            },
            25: {
                "< 3:1": [0, 4, 4, 6, 8, 11, 20, 33, 49, 69, 92, 100],
                "3:1 à 10:1": [0, 4, 5, 7, 9, 13, 22, 35, 51, 71, 94, 100],
                "> 10:1": [0, 4, 6, 10, 15, 20, 31, 45, 62, 82, 100]
            },
            30: {
                "< 3:1": [0, 4, 4, 5, 7, 10, 18, 28, 42, 58, 77, 100],
                "3:1 à 10:1": [0, 4, 4, 6, 9, 12, 20, 30, 44, 60, 80, 100],
                "> 10:1": [0, 4, 6, 10, 14, 18, 28, 40, 54, 71, 91, 100]
            },
            40: {
                "< 3:1": [0, 4, 4, 5, 6, 8, 14, 22, 32, 44, 59, 76, 94, 100],
                "3:1 à 10:1": [0, 4, 4, 6, 8, 10, 16, 24, 34, 47, 61, 78, 97, 100],
                "> 10:1": [0, 4, 5, 8, 12, 15, 23, 33, 44, 57, 72, 89, 100]
            },
            50: {
                "< 3:1": [0, 4, 4, 5, 6, 7, 12, 18, 26, 36, 48, 61, 76, 93, 100],
                "3:1 à 10:1": [0, 4, 4, 5, 7, 9, 14, 20, 29, 38, 50, 63, 79, 95, 100],
                "> 10:1": [0, 4, 5, 8, 11, 14, 21, 29, 38, 48, 61, 74, 90, 100]
            },
            60: {
                "< 3:1": [0, 4, 4, 4, 5, 7, 11, 16, 23, 31, 40, 52, 64, 78, 94, 100],
                "3:1 à 10:1": [0, 4, 4, 5, 6, 8, 12, 18, 25, 33, 43, 54, 66, 81, 96, 100],
                "> 10:1": [0, 4, 5, 7, 10, 13, 19, 26, 34, 43, 53, 64, 77, 92, 100]
            },
            80: {
                "< 3:1": [0, 4, 4, 4, 5, 6, 9, 13, 18, 24, 31, 40, 49, 60, 71, 84, 98, 100],
                "3:1 à 10:1": [0, 4, 4, 5, 6, 7, 10, 15, 20, 26, 33, 42, 51, 62, 74, 86, 100],
                "> 10:1": [0, 4, 5, 6, 9, 11, 16, 22, 28, 35, 43, 52, 62, 73, 85, 98, 100]
            },
            100: {
                "< 3:1": [0, 4, 4, 4, 5, 5, 8, 11, 15, 20, 26, 32, 40, 48, 58, 68, 79, 100],
                "3:1 à 10:1": [0, 4, 4, 4, 5, 6, 9, 13, 17, 22, 28, 35, 42, 51, 60, 70, 81, 100],
                "> 10:1": [0, 4, 4, 6, 8, 10, 14, 19, 25, 31, 37, 44, 52, 61, 71, 81, 92, 100]
            },
            150: {
                "< 3:1": [0, 4, 4, 4, 4, 5, 6, 8, 11, 14, 18, 23, 28, 33, 40, 46, 54, 70, 89, 100],
                "3:1 à 10:1": [0, 4, 4, 4, 5, 6, 8, 10, 13, 16, 20, 25, 30, 36, 42, 49, 56, 73, 92, 100],
                "> 10:1": [0, 4, 4, 5, 7, 8, 12, 16, 20, 24, 29, 34, 39, 46, 52, 59, 67, 84, 100]
            },
            250: {
                "< 3:1": [0, 4, 4, 4, 4, 4, 5, 7, 8, 10, 12, 15, 18, 22, 25, 29, 34, 44, 55, 68, 100],
                "3:1 à 10:1": [0, 4, 4, 4, 4, 5, 6, 8, 10, 12, 14, 17, 20, 24, 27, 32, 36, 46, 57, 70, 100],
                "> 10:1": [0, 4, 4, 5, 6, 7, 9, 12, 15, 18, 21, 25, 28, 32, 37, 41, 46, 56, 68, 81, 100]
            },
            350: {
                "< 3:1": [0, 4, 4, 4, 4, 4, 5, 6, 7, 8, 10, 12, 14, 16, 19, 22, 25, 32, 40, 49, 77, 100],
                "3:1 à 10:1": [0, 4, 4, 4, 4, 4, 5, 7, 8, 10, 12, 14, 16, 18, 21, 24, 27, 34, 43, 52, 79, 100],
                "> 10:1": [0, 4, 4, 4, 5, 6, 8, 10, 13, 15, 18, 21, 23, 26, 30, 33, 36, 44, 53, 62, 90, 100]
            },
            500: {
                "< 3:1": [0, 4, 4, 4, 4, 4, 4, 5, 6, 7, 8, 9, 11, 13, 14, 16, 19, 24, 29, 36, 55, 78, 100],
                "3:1 à 10:1": [0, 4, 4, 4, 4, 4, 5, 6, 7, 8, 9, 11, 13, 14, 16, 18, 21, 26, 31, 38, 57, 80, 100],
                "> 10:1": [0, 4, 4, 4, 5, 5, 7, 9, 11, 13, 15, 17, 19, 21, 24, 26, 29, 35, 41, 48, 68, 92, 100]
            },
            1000: {
                "< 3:1": [0, 4, 4, 4, 4, 4, 4, 4, 5, 5, 6, 6, 7, 8, 9, 10, 11, 14, 16, 20, 29, 41, 55, 71, 89, 100],
                "3:1 à 10:1": [0, 4, 4, 4, 4, 4, 4, 5, 5, 6, 7, 8, 9, 10, 11, 12, 13, 15, 18, 22, 31, 43, 57, 73, 91, 100],
                "> 10:1": [0, 4, 4, 4, 4, 5, 6, 7, 8, 9, 11, 12, 13, 15, 16, 18, 20, 23, 26, 30, 41, 53, 68, 84, 100]
            },
            2000: {
                "< 3:1": [0, 4, 4, 4, 4, 4, 4, 4, 4, 4, 5, 5, 5, 6, 6, 7, 7, 9, 10, 12, 16, 22, 29, 37, 46, 56, 68, 80, 94, 100],
                "3:1 à 10:1": [0, 4, 4, 4, 4, 4, 4, 4, 5, 5, 5, 6, 6, 7, 7, 8, 9, 10, 12, 13, 18, 24, 31, 39, 49, 59, 70, 83, 96, 100],
                "> 10:1": [0, 4, 4, 4, 4, 4, 5, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 16, 18, 20, 26, 33, 41, 50, 59, 70, 81, 94, 100]
            }
        };
        
        // Tableau 3.2.3.1.-D - Bâtiment protégé par gicleurs - Usages des groupes A, B, C, D et F3
        const tableauAvecGicleursGroupesABCDF3 = {
            10: [0, 16, 24, 42, 66, 100],
            15: [0, 16, 20, 34, 50, 74, 100],
            20: [0, 16, 20, 30, 42, 60, 100],
            25: [0, 16, 18, 26, 38, 52, 90, 100],
            30: [0, 14, 18, 24, 34, 46, 78, 100],
            40: [0, 14, 16, 22, 30, 40, 64, 96, 100],
            50: [0, 14, 16, 20, 28, 36, 56, 82, 100],
            60: [0, 14, 16, 20, 26, 32, 50, 72, 98, 100],
            80: [0, 14, 16, 18, 22, 28, 42, 58, 80, 100],
            100: [0, 14, 16, 18, 22, 26, 36, 50, 68, 88, 100],
            150: [0, 14, 14, 16, 20, 22, 30, 40, 52, 66, 82, 100]
        };
        
        // Tableau 3.2.3.1.-E - Bâtiment protégé par gicleurs - Usages des groupes E, F1 et F2
        const tableauAvecGicleursGroupesEF1F2 = {
            10: [0, 8, 12, 20, 34, 50, 96, 100],
            15: [0, 8, 10, 16, 26, 36, 68, 100],
            20: [0, 8, 10, 14, 22, 30, 54, 86, 100],
            25: [0, 8, 10, 14, 18, 26, 44, 70, 100],
            30: [0, 8, 8, 12, 18, 24, 40, 60, 88, 100],
            40: [0, 8, 8, 12, 16, 20, 32, 48, 68, 94, 100],
            50: [0, 8, 8, 10, 14, 18, 28, 40, 58, 76, 100],
            60: [0, 8, 8, 10, 12, 16, 24, 36, 50, 66, 86, 100],
            80: [0, 8, 8, 10, 12, 14, 20, 30, 40, 52, 66, 84, 100],
            100: [0, 8, 8, 8, 10, 12, 18, 26, 34, 44, 56, 70, 84, 100],
            150: [0, 8, 8, 8, 10, 12, 16, 20, 26, 32, 40, 50, 60, 72, 84, 98, 100],
            200: [0, 8, 8, 8, 8, 10, 14, 18, 22, 28, 34, 42, 50, 60, 68, 80, 92, 100]
        };

        const limitingDistancesNoSprinklers = [0, 1.2, 1.5, 2.0, 2.5, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 16, 18, 20, 25, 30, 35, 40, 45, 50, 55, 60, 65, 70];
        const limitingDistancesWithSprinklersABCDF3 = [0, 1.2, 1.5, 2.0, 2.5, 3, 4, 5, 6, 7, 8, 9];
        const limitingDistancesWithSprinklersEF1F2 = [0, 1.2, 1.5, 2.0, 2.5, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15];
        const facadeSurfaces = [10, 15, 20, 25, 30, 40, 50, 60, 80, 100, 150, 250, 350, 500, 1000, 2000];
        const facadeSurfacesWithSprinklersABCDF3 = [10, 15, 20, 25, 30, 40, 50, 60, 80, 100, 150, 250, 350, 500, 1000, 2000];
        const facadeSurfacesWithSprinklersEF1F2 = [10, 15, 20, 25, 30, 40, 50, 60, 80, 100, 150, 200];

        function getRatioCategory(length, height) {
            const ratioLH = length / height;
            const ratioHL = height / length;
            const maxRatio = Math.max(ratioLH, ratioHL);
            if (maxRatio < 3) return "< 3:1";
            if (maxRatio <= 10) return "3:1 à 10:1";
            return "> 10:1";
        }

        function interpolate(x, x1, x2, y1, y2) {
            if (x1 === x2) return y1;
            return y1 + (y2 - y1) * (x - x1) / (x2 - x1);
        }

        function findBounds(value, array) {
            // Si la valeur est inférieure au premier élément
            if (value <= array[0]) {
                return { lower: array[0], upper: array[1] };
            }
            // Si la valeur est supérieure au dernier élément
            if (value >= array[array.length - 1]) {
                return { lower: array[array.length - 2], upper: array[array.length - 1] };
            }
            // Recherche des bornes
            for (let i = 0; i < array.length - 1; i++) {
                if (value >= array[i] && value <= array[i + 1]) {
                    return { lower: array[i], upper: array[i + 1] };
                }
            }
            return { lower: array[0], upper: array[1] }; // Valeur par défaut
        }

        function calculateCNB() {
            const facadeSurface = parseFloat(document.getElementById('surface_cnb').value);
            const length = parseFloat(document.getElementById('length_cnb').value);
            const height = parseFloat(document.getElementById('height_cnb').value);
            let limitingDistance = parseFloat(document.getElementById('distance_cnb').value);
            const sprinklers = document.getElementById('sprinklers_cnb').checked;
            const response = document.getElementById('response_cnb').checked;
            const usage = document.getElementById('usage_cnb').value;
            const constructionType = document.getElementById('construction_type_cnb').value;
            const revetementType = document.getElementById('revetement_type_cnb').value;
            const glassBrick = document.getElementById('glass_brick_cnb').checked;

            // Vérification des entrées
            if (isNaN(facadeSurface) || isNaN(length) || isNaN(height) || isNaN(limitingDistance) || 
                facadeSurface <= 0 || length <= 0 || height <= 0 || limitingDistance < 0) {
                document.getElementById('cnb-result').innerHTML = "Erreur : Veuillez entrer des valeurs numériques valides.";
                return;
            }

            // Ajustement pour le délai d'intervention
            if (response) {
                limitingDistance = limitingDistance / 2;
            }

            const ratioCategory = getRatioCategory(length, height);
            
            // Choix du tableau selon l'usage et les gicleurs
            let tableToUse, distancesToUse, surfacesToUse;
            
            if (sprinklers) {
                if (usage === "groupes_A_B3_C_D_F3") {
                    tableToUse = tableauAvecGicleursGroupesABCDF3;
                    distancesToUse = limitingDistancesWithSprinklersABCDF3;
                    surfacesToUse = facadeSurfacesWithSprinklersABCDF3;
                } else {
                    tableToUse = tableauAvecGicleursGroupesEF1F2;
                    distancesToUse = limitingDistancesWithSprinklersEF1F2;
                    surfacesToUse = facadeSurfacesWithSprinklersEF1F2;
                }
            } else {
                distancesToUse = limitingDistancesNoSprinklers;
                surfacesToUse = facadeSurfaces;
                if (usage === "groupes_A_B3_C_D_F3") {
                    tableToUse = tableauGroupesAB3CDF3;
                } else {
                    tableToUse = tableauGroupesEF1F2;
                }
            }

            // Si la distance limitative dépasse la plage du tableau
            if (limitingDistance > distancesToUse[distancesToUse.length - 1]) {
                document.getElementById('cnb-result').innerHTML = 
                    `Distance limitative (${limitingDistance.toFixed(2)} m) supérieure aux valeurs du tableau.<br>
                    <strong>Surface maximale des baies non protégées : 100%</strong>`;
                return;
            }

            // Trouver les bornes pour l'interpolation de distance
            const { lower: lowerDistance, upper: upperDistance } = findBounds(limitingDistance, distancesToUse);
            const lowerDistanceIndex = distancesToUse.indexOf(lowerDistance);
            const upperDistanceIndex = distancesToUse.indexOf(upperDistance);

            // Trouver les surfaces les plus proches pour l'interpolation
            // Recherche des surfaces encadrantes
            let lowerSurface = surfacesToUse[0];
            let upperSurface = surfacesToUse[surfacesToUse.length - 1];

            for (let i = 0; i < surfacesToUse.length - 1; i++) {
                if (facadeSurface >= surfacesToUse[i] && facadeSurface <= surfacesToUse[i + 1]) {
                    lowerSurface = surfacesToUse[i];
                    upperSurface = surfacesToUse[i + 1];
                    break;
                }
            }

            // Si la façade est plus petite que la plus petite surface du tableau
            if (facadeSurface < surfacesToUse[0]) {
                lowerSurface = surfacesToUse[0];
                upperSurface = surfacesToUse[1];
            }
            
            // Si la façade est plus grande que la plus grande surface du tableau
            if (facadeSurface > surfacesToUse[surfacesToUse.length - 1]) {
                lowerSurface = surfacesToUse[surfacesToUse.length - 2];
                upperSurface = surfacesToUse[surfacesToUse.length - 1];
            }

            let lowerSurfacePercentageLower, lowerSurfacePercentageUpper;
            let upperSurfacePercentageLower, upperSurfacePercentageUpper;

            // Extraire les pourcentages et interpoler selon que le bâtiment est protégé par gicleurs ou non
            if (sprinklers) {
                // Avec gicleurs (pas de ratio)
                lowerSurfacePercentageLower = tableToUse[lowerSurface][lowerDistanceIndex];
                lowerSurfacePercentageUpper = tableToUse[lowerSurface][upperDistanceIndex];
                
                upperSurfacePercentageLower = tableToUse[upperSurface][lowerDistanceIndex];
                upperSurfacePercentageUpper = tableToUse[upperSurface][upperDistanceIndex];
            } else {
                // Sans gicleurs (avec ratio)
                lowerSurfacePercentageLower = tableToUse[lowerSurface][ratioCategory][lowerDistanceIndex];
                lowerSurfacePercentageUpper = tableToUse[lowerSurface][ratioCategory][upperDistanceIndex];
                
                upperSurfacePercentageLower = tableToUse[upperSurface][ratioCategory][lowerDistanceIndex];
                upperSurfacePercentageUpper = tableToUse[upperSurface][ratioCategory][upperDistanceIndex];
            }

            // Interpolation des pourcentages pour la distance limitative
            const lowerSurfacePercentage = interpolate(
                limitingDistance,
                lowerDistance,
                upperDistance,
                lowerSurfacePercentageLower,
                lowerSurfacePercentageUpper
            );

            const upperSurfacePercentage = interpolate(
                limitingDistance,
                lowerDistance,
                upperDistance,
                upperSurfacePercentageLower,
                upperSurfacePercentageUpper
            );

            // Interpolation finale entre les surfaces
            let finalPercentage;
            if (lowerSurface === upperSurface) {
                finalPercentage = lowerSurfacePercentage;
            } else {
                finalPercentage = interpolate(
                    facadeSurface,
                    lowerSurface,
                    upperSurface,
                    lowerSurfacePercentage,
                    upperSurfacePercentage
                );
            }
            
            // Limiter le pourcentage entre 0 et 100
            finalPercentage = Math.max(0, Math.min(100, finalPercentage));
            
            // Majoration en cas de briques de verre / verre armé
            if (glassBrick) {
                finalPercentage = Math.min(100, finalPercentage * 2);
            }
            
            // Calculer la surface maximale
            const maxArea = (finalPercentage / 100) * facadeSurface;
            
            // Déterminer les exigences de construction selon 3.2.3.7
            let constructionRequirements = determineConstructionRequirements(finalPercentage, usage, constructionType, revetementType);

            // Afficher les résultats détaillés
            let resultHTML = `
                <strong>Données de calcul :</strong><br>
                ${response ? "Distance limitative ajustée : " + limitingDistance.toFixed(2) + " m<br>" : ""}
                Rapport L/H ou H/L : ${ratioCategory}<br>
                Type de construction : ${constructionType}<br>
                Type de revêtement : ${revetementType}<br>
                ${glassBrick ? "Majoration pour briques de verre/verre armé appliquée (x2)<br>" : ""}
                <br><strong>Détails d'interpolation :</strong><br>
                Distance limitative entre ${lowerDistance} m et ${upperDistance} m<br>
                Surface de référence entre ${lowerSurface} m² et ${upperSurface} m²<br>
                <br><strong>Résultats :</strong><br>
                Pourcentage maximal de baies non protégées : ${finalPercentage.toFixed(2)}%<br>
                Surface maximale de baies non protégées : ${maxArea.toFixed(2)} m²
                ${constructionRequirements}
            `;

            document.getElementById('cnb-result').innerHTML = resultHTML;
        }
        
        function determineConstructionRequirements(percentage, usage, constructionType, revetementType) {
            // Déterminer le degré de résistance au feu et les exigences de construction selon 3.2.3.7
            let degre = "";
            let constructionExigence = "";
            let revetementExigence = "";
            
            if (percentage <= 10) {
                if (usage === "groupes_A_B3_C_D_F3") {
                    degre = "1 h";
                } else { // groupes_E_F1_F2
                    degre = "2 h";
                }
                constructionExigence = "Incombustible";
                revetementExigence = "Incombustible";
            } else if (percentage <= 25) {
                if (usage === "groupes_A_B3_C_D_F3") {
                    degre = "1 h";
                } else { // groupes_E_F1_F2
                    degre = "2 h";
                }
                constructionExigence = "Combustible ou incombustible";
                revetementExigence = "Incombustible";
            } else if (percentage <= 50) {
                if (usage === "groupes_A_B3_C_D_F3") {
                    degre = "45 min";
                } else { // groupes_E_F1_F2
                    degre = "1 h";
                }
                constructionExigence = "Combustible ou incombustible";
                revetementExigence = "Incombustible";
            } else if (percentage < 100) {
                if (usage === "groupes_A_B3_C_D_F3") {
                    degre = "45 min";
                } else { // groupes_E_F1_F2
                    degre = "1 h";
                }
                constructionExigence = "Combustible ou incombustible";
                revetementExigence = "Combustible ou incombustible";
            }
            
            // Si la construction actuelle n'est pas conforme, ajouter un avertissement
            let warningMsg = "";
            if ((constructionExigence === "Incombustible" && constructionType === "combustible") ||
                (revetementExigence === "Incombustible" && revetementType === "combustible")) {
                warningMsg = "<br>⚠️ <strong>Attention :</strong> La construction ou le revêtement sélectionné ne respecte pas les exigences minimales du tableau 3.2.3.7.";
            }
            
            return `
                <br><strong>Exigences de construction (tableau 3.2.3.7):</strong><br>
                Pour ${percentage.toFixed(2)}% de baies non protégées:<br>
                - Degré de résistance au feu minimal: ${degre}<br>
                - Type de construction exigé: ${constructionExigence}<br>
                - Type de revêtement exigé: ${revetementExigence}${warningMsg}
            `;
        }

        // Données du Tableau 9.10.14.4-A
        const tableau91014 = {
            "habitation": {
                surfaces: {
                    30: [0, 7, 9, 12, 39, 88, 100, 100, 100, 100, 100, 100, 100],
                    40: [0, 7, 8, 11, 32, 69, 100, 100, 100, 100, 100, 100, 100],
                    50: [0, 7, 8, 10, 28, 57, 100, 100, 100, 100, 100, 100, 100],
                    100: [0, 7, 8, 9, 18, 34, 56, 84, 100, 100, 100, 100, 100],
                    ">100": [0, 7, 7, 8, 12, 19, 28, 40, 55, 92, 100, 100, 100]
                },
                distances: [0, 1.2, 1.5, 2.0, 4.0, 6.0, 8.0, 10.0, 12.0, 16.0, 20.0, 25.0, 30.0]
            },
            "commercial": {
                surfaces: {
                    30: [0, 4, 4, 6, 20, 44, 80, 100, 100, 100, 100, 100, 100],
                    40: [0, 4, 4, 6, 16, 34, 61, 97, 100, 100, 100, 100, 100],
                    50: [0, 4, 4, 5, 14, 29, 50, 79, 100, 100, 100, 100, 100],
                    100: [0, 4, 4, 4, 9, 17, 28, 42, 60, 100, 100, 100, 100],
                    ">100": [0, 4, 4, 4, 6, 10, 14, 20, 27, 46, 70, 100, 100]
                },
                distances: [0, 1.2, 1.5, 2.0, 4.0, 6.0, 8.0, 10.0, 12.0, 16.0, 20.0, 25.0, 30.0]
            }
        };

        function calculate91014() {
            const usage = document.getElementById('usage_91014').value;
            const buildingType = document.getElementById('building_type_91014').value;
            const exteriorFinish = document.getElementById('exterior_finish_91014').value;
            const soffit_protection = document.getElementById('soffit_protection_91014').checked;
            let limitingDistance = parseFloat(document.getElementById('distance_91014').value);
            const surface = parseFloat(document.getElementById('surface_91014').value);
            const response = document.getElementById('response_91014').checked;

            // Vérification des entrées
            if (isNaN(limitingDistance) || isNaN(surface) || limitingDistance < 0 || surface <= 0) {
                document.getElementById('method91014-result').innerHTML = "Erreur : Veuillez entrer des valeurs numériques valides.";
                return;
            }

            // Ajustement pour le délai d'intervention
            if (response) {
                limitingDistance = limitingDistance / 2;
            }
            
            // Exemption pour les garages ou bâtiments secondaires
            if (buildingType === "garage") {
                // Selon 9.10.14.4.(10-12), les baies vitrées des garages peuvent être exemptées des restrictions
                document.getElementById('method91014-result').innerHTML = `
                    <strong>Résultat pour garage ou bâtiment secondaire :</strong><br>
                    Selon les paragraphes 9.10.14.4.(10-12) et 9.10.14.5.(4-5), les garages et bâtiments secondaires 
                    qui ne desservent qu'un seul logement peuvent bénéficier d'exemptions importantes:<br><br>
                    
                    - Si le garage dessert un seul logement et est sur la même propriété: 
                      <strong>pas de limite de surface pour les baies vitrées</strong><br>
                    - Pour la construction de la façade de rayonnement, si la distance limitative est d'au moins 0,6 m:
                      <strong>pas d'exigence quant au degré de résistance au feu</strong><br>
                    - Si la distance limitative est inférieure à 0,6 m: <strong>un degré de résistance au feu d'au moins 
                      45 min est requis</strong><br>
                    - <strong>Aucune exigence quant au type de revêtement</strong>, peu importe la distance limitative<br><br>
                    
                    Pour une analyse plus spécifique, veuillez sélectionner "Bâtiment standard" dans le type de bâtiment.
                `;
                return;
            }

            const distances = tableau91014[usage].distances;
            
            // Si la distance limitative dépasse la plage du tableau
            if (limitingDistance > distances[distances.length - 1]) {
                document.getElementById('method91014-result').innerHTML = 
                    `Distance limitative (${limitingDistance.toFixed(2)} m) supérieure aux valeurs du tableau.<br>
                    <strong>Surface maximale des baies non protégées : 100%</strong>`;
                return;
            }

            // Trouver les bornes pour l'interpolation de distance
            const { lower: lowerDistance, upper: upperDistance } = findBounds(limitingDistance, distances);
            const lowerDistanceIndex = distances.indexOf(lowerDistance);
            const upperDistanceIndex = distances.indexOf(upperDistance);

            // Définir les surfaces connues du tableau pour l'interpolation
            const surfaceValues = [30, 40, 50, 100];
            
            // Trouver les surfaces les plus proches pour l'interpolation
            let lowerSurface, upperSurface;
            
            if (surface <= 30) {
                lowerSurface = 30;
                upperSurface = 40;
            } else if (surface <= 40) {
                lowerSurface = 30;
                upperSurface = 40;
            } else if (surface <= 50) {
                lowerSurface = 40;
                upperSurface = 50;
            } else if (surface <= 100) {
                lowerSurface = 50;
                upperSurface = 100;
            } else {
                lowerSurface = 100;
                upperSurface = ">100";
            }
            
            // Calculer le pourcentage pour la surface inférieure
            const lowerSurfacePercentageLower = tableau91014[usage].surfaces[lowerSurface][lowerDistanceIndex];
            const lowerSurfacePercentageUpper = tableau91014[usage].surfaces[lowerSurface][upperDistanceIndex];
            const lowerSurfacePercentage = interpolate(
                limitingDistance, 
                lowerDistance, 
                upperDistance, 
                lowerSurfacePercentageLower, 
                lowerSurfacePercentageUpper
            );
            
            // Calculer le pourcentage pour la surface supérieure
            const upperSurfacePercentageLower = tableau91014[usage].surfaces[upperSurface === ">100" ? ">100" : upperSurface][lowerDistanceIndex];
            const upperSurfacePercentageUpper = tableau91014[usage].surfaces[upperSurface === ">100" ? ">100" : upperSurface][upperDistanceIndex];
            const upperSurfacePercentage = interpolate(
                limitingDistance, 
                lowerDistance, 
                upperDistance, 
                upperSurfacePercentageLower, 
                upperSurfacePercentageUpper
            );
            
            // Interpolation finale entre les surfaces
            let finalPercentage;
            if (surface > 100) {
                // Si la surface est > 100, on utilise la formule du CNB 
                // (LC-1.2m)² pour habitations et 0.5 x (LC-1.2m)² pour établissements commerciaux
                if (limitingDistance >= 1.2) {
                    if (usage === "habitation") {
                        finalPercentage = Math.pow(limitingDistance, 2);
                    } else { // commercial
                        finalPercentage = 0.5 * Math.pow(limitingDistance, 2);
                    }
                    // Limiter à 100%
                    finalPercentage = Math.min(finalPercentage, 100);
                } else {
                    finalPercentage = upperSurfacePercentage; // Utiliser les valeurs du tableau pour >100
                }
            } else if (lowerSurface === upperSurface) {
                finalPercentage = lowerSurfacePercentage;
            } else {
                finalPercentage = interpolate(
                    surface, 
                    lowerSurface, 
                    upperSurface, 
                    lowerSurfacePercentage, 
                    upperSurfacePercentage
                );
            }
            
            // Limiter le pourcentage entre 0 et 100
            finalPercentage = Math.max(0, Math.min(100, finalPercentage));
            
            // Calculer la surface maximale
            const maxArea = (finalPercentage / 100) * surface;
            
            // Déterminer les exigences de construction et de protection
            let constructionRequirements = "";
            
            if (limitingDistance < 1.2) {
                constructionRequirements = `
                    <br><strong>Exigences pour distance limitative < 1,2 m (9.10.14.4.2):</strong><br>
                    - Les ouvertures doivent être protégées par des dispositifs d'obturation<br>
                    - Le verre armé et les briques de verre ne sont pas autorisés<br>
                    - ${exteriorFinish === "incombustible" ? 
                        "Revêtement incombustible requis pour les façades" : 
                        "Revêtement combustible soumis à des restrictions importantes (voir 9.10.14.5)"}<br>
                `;
            }
            
            // Informations sur les soffites
            let soffitInfo = "";
            if (limitingDistance < 0.45) {
                soffitInfo = `
                    <br><strong>Protection des soffites (9.10.14.5.9):</strong><br>
                    - Aucun soffite de toit en saillie ne doit être construit au-dessus de la façade de rayonnement<br>
                `;
            } else if (limitingDistance < 1.2) {
                soffitInfo = `
                    <br><strong>Protection des soffites (9.10.14.5.10-12):</strong><br>
                    - Les soffites ne doivent pas faire saillie à moins de 0,45 m de la limite de propriété<br>
                    - Si un soffite fait saillie à moins de 1,2 m de la limite de propriété, il doit:<br>
                    &nbsp;&nbsp;• Ne comporter aucune ouverture<br>
                    &nbsp;&nbsp;• Être protégé par un matériau approprié selon 9.10.14.5.12)b)<br>
                    ${soffit_protection ? "✅ Vous avez indiqué que les soffites sont protégés conformément au code." : 
                    "⚠️ Protection des soffites requise mais non confirmée."}
                `;
            }

            // Afficher les résultats avec détails des calculs intermédiaires
            let resultHTML = `
                <strong>Données de calcul :</strong><br>
                ${response ? "Distance limitative ajustée : " + limitingDistance.toFixed(2) + " m<br>" : ""}
                Type d'usage : ${usage === "habitation" ? "Habitation, établissement d'affaires et établissement industriel à risques faibles" : "Établissement commercial et établissement industriel à risques moyens"}<br>
                Surface totale de la façade : ${surface.toFixed(2)} m²<br>
                <br><strong>Détails d'interpolation :</strong><br>
                Distance limitative entre ${lowerDistance} m et ${upperDistance} m<br>
                Surface de référence entre ${lowerSurface === upperSurface ? lowerSurface : lowerSurface + " m² et " + upperSurface + " m²"}<br>
                <br><strong>Résultats :</strong><br>
                Pourcentage maximal de baies non protégées : ${finalPercentage.toFixed(2)}%<br>
                Surface maximale de baies non protégées : ${maxArea.toFixed(2)} m²
                ${constructionRequirements}
                ${soffitInfo}
            `;

            document.getElementById('method91014-result').innerHTML = resultHTML;
        }

        // Données du Tableau 9.10.15.4
        const tableau91015 = {
            surfaces: {
                30: [0, 7, 9, 12, 39, 88, 100, 100, 100, 100, 100],
                40: [0, 7, 8, 11, 32, 69, 100, 100, 100, 100, 100],
                50: [0, 7, 8, 10, 28, 57, 100, 100, 100, 100, 100],
                100: [0, 7, 8, 9, 18, 34, 56, 84, 100, 100, 100],
                ">100": [0, 7, 7, 8, 12, 19, 28, 40, 55, 92, 100]
            },
            distances: [0, 1.2, 1.5, 2.0, 4.0, 6.0, 8.0, 10.0, 12.0, 16.0, 20.0]
        };

        function calculate91015() {
            let limitingDistance = parseFloat(document.getElementById('distance_91015').value);
            const surface = parseFloat(document.getElementById('surface_91015').value);
            const response = document.getElementById('response_91015').checked;
            const housingType = document.getElementById('housing_type_91015').value;
            const revetingType = document.getElementById('reveting_type_91015').value;

            // Vérification des entrées
            if (isNaN(limitingDistance) || isNaN(surface) || limitingDistance < 0 || surface <= 0) {
                document.getElementById('method91015-result').innerHTML = "Erreur : Veuillez entrer des valeurs numériques valides.";
                return;
            }

            // Ajustement pour le délai d'intervention
            if (response) {
                limitingDistance = limitingDistance / 2;
            }

            const distances = tableau91015.distances;
            
            // Si la distance limitative dépasse la plage du tableau
            if (limitingDistance > distances[distances.length - 1]) {
                document.getElementById('method91015-result').innerHTML = 
                    `Distance limitative (${limitingDistance.toFixed(2)} m) supérieure aux valeurs du tableau.<br>
                    <strong>Surface maximale des baies non protégées : 100%</strong>`;
                return;
            }

            // Trouver les bornes pour l'interpolation de distance
            const { lower: lowerDistance, upper: upperDistance } = findBounds(limitingDistance, distances);
            const lowerDistanceIndex = distances.indexOf(lowerDistance);
            const upperDistanceIndex = distances.indexOf(upperDistance);

            // Définir les surfaces connues du tableau pour l'interpolation
            const surfaceValues = [30, 40, 50, 100];
            
            // Trouver les surfaces les plus proches pour l'interpolation
            let lowerSurface, upperSurface;
            
            if (surface <= 30) {
                lowerSurface = 30;
                upperSurface = 40;
            } else if (surface <= 40) {
                lowerSurface = 30;
                upperSurface = 40;
            } else if (surface <= 50) {
                lowerSurface = 40;
                upperSurface = 50;
            } else if (surface <= 100) {
                lowerSurface = 50;
                upperSurface = 100;
            } else {
                lowerSurface = 100;
                upperSurface = ">100";
            }
            
            // Calculer le pourcentage pour la surface inférieure
            const lowerSurfacePercentageLower = tableau91015.surfaces[lowerSurface][lowerDistanceIndex];
            const lowerSurfacePercentageUpper = tableau91015.surfaces[lowerSurface][upperDistanceIndex];
            const lowerSurfacePercentage = interpolate(
                limitingDistance, 
                lowerDistance, 
                upperDistance, 
                lowerSurfacePercentageLower, 
                lowerSurfacePercentageUpper
            );
            
            // Calculer le pourcentage pour la surface supérieure
            const upperSurfacePercentageLower = tableau91015.surfaces[upperSurface === ">100" ? ">100" : upperSurface][lowerDistanceIndex];
            const upperSurfacePercentageUpper = tableau91015.surfaces[upperSurface === ">100" ? ">100" : upperSurface][upperDistanceIndex];
            const upperSurfacePercentage = interpolate(
                limitingDistance, 
                lowerDistance, 
                upperDistance, 
                upperSurfacePercentageLower, 
                upperSurfacePercentageUpper
            );
            
            // Interpolation finale entre les surfaces
            let finalPercentage;
            if (surface > 100) {
                // Si la surface est > 100, on utilise la formule du CNB 
                // (LC-1.2m)² pour habitations et 0.5 x (LC-1.2m)² pour établissements commerciaux
                if (limitingDistance >= 1.2) {
                    finalPercentage = Math.pow(limitingDistance, 2);
                    // Limiter à 100%
                    finalPercentage = Math.min(finalPercentage, 100);
                } else {
                    finalPercentage = upperSurfacePercentage; // Utiliser les valeurs du tableau pour >100
                }
            } else if (lowerSurface === upperSurface) {
                finalPercentage = lowerSurfacePercentage;
            } else {
                finalPercentage = interpolate(
                    surface, 
                    lowerSurface, 
                    upperSurface, 
                    lowerSurfacePercentage, 
                    upperSurfacePercentage
                );
            }
            
            // Limiter le pourcentage entre 0 et 100
            finalPercentage = Math.max(0, Math.min(100, finalPercentage));
            
            // Calculer la surface maximale
            const maxArea = (finalPercentage / 100) * surface;
            
            // Déterminer les exigences de construction
            let constructionRequirements = "";
            if (limitingDistance < 0.6) {
                constructionRequirements = `
                    <br><strong>Exigences de construction (selon 9.10.15.5):</strong><br>
                    - Degré de résistance au feu d'au moins 45 min pour la façade de rayonnement<br>
                    - Revêtement extérieur ${revetingType === "incombustible" ? "incombustible" : "combustible avec contraintes"}<br>
                    ${revetingType === "combustible" ? 
                    `- Le revêtement combustible doit être installé selon l'article 9.10.15.5, paragraphe 2):<br>
                       &nbsp;&nbsp;• Posé sur revêtement en plaques de plâtre d'au moins 12,7 mm ou maçonnerie<br>
                       &nbsp;&nbsp;• Doit avoir un indice de propagation de la flamme d'au plus 25<br>
                       &nbsp;&nbsp;• Si c'est un revêtement conforme à 9.27.12, son épaisseur ne doit pas dépasser 2 mm<br>
                       &nbsp;&nbsp;• Peut aussi être conforme à l'alinéa 3.1.5.5.1)b)`
                     : ""}
                `;
            } else if (limitingDistance < 1.2) {
                constructionRequirements = `
                    <br><strong>Exigences de construction (selon 9.10.15.5):</strong><br>
                    - Degré de résistance au feu d'au moins 45 min pour la façade de rayonnement<br>
                    ${revetingType === "combustible" ? 
                    `- Revêtement combustible soumis aux exigences du paragraphe 3) de l'article 9.10.15.5:<br>
                       &nbsp;&nbsp;• Si conforme à 9.27.6, 9.27.7, 9.27.8, 9.27.9 ou 9.27.10:<br>
                       &nbsp;&nbsp;&nbsp;&nbsp;- Posé sur revêtement en plaques de plâtre d'au moins 12,7 mm ou maçonnerie<br>
                       &nbsp;&nbsp;&nbsp;&nbsp;- Doit avoir un indice de propagation de la flamme d'au plus 25 après conditionnement<br>
                       &nbsp;&nbsp;• Si conforme à 9.27.12:<br>
                       &nbsp;&nbsp;&nbsp;&nbsp;- Posé sur revêtement en plaques de plâtre d'au moins 12,7 mm ou maçonnerie<br>
                       &nbsp;&nbsp;&nbsp;&nbsp;- Doit avoir un indice de propagation de la flamme d'au plus 25<br>
                       &nbsp;&nbsp;&nbsp;&nbsp;- Ne doit pas dépasser 2 mm d'épaisseur<br>
                       &nbsp;&nbsp;• Peut aussi être conforme à l'alinéa 3.1.5.5.1)b)`
                     : "- Revêtement incombustible selon la section 9.20, la sous-section 9.27.11 ou la section 9.28"}
                `;
            } else {
                constructionRequirements = `
                    <br><strong>Exigences de construction (selon 9.10.15.5):</strong><br>
                    - Pour distance limitative ≥ 1,2 m: les restrictions sont moins sévères<br>
                    - Les exigences minimales pour les soffites s'appliquent quand ils font saillie à moins de 1,2 m de la limite de propriété<br>
                    - Pour les poteaux en gros bois d'œuvre: pas de conformité nécessaire si distance ≥ 3 m
                `;
            }
            
            // Ajouter des informations spécifiques au type d'habitation
            let housingInfo = "";
            if (housingType === "accessoire") {
                housingInfo = `
                    <br><strong>Remarque pour logement accessoire:</strong><br>
                    - Les maisons comportant un logement accessoire peuvent avoir des exigences supplémentaires.<br>
                    - Vérifier également les exigences de l'article 9.10.15.5 pour les revêtements.<br>
                `;
            }

            // Afficher les résultats avec détails des calculs intermédiaires
            let resultHTML = `
                <strong>Données de calcul :</strong><br>
                ${response ? "Distance limitative ajustée : " + limitingDistance.toFixed(2) + " m<br>" : ""}
                Surface totale de la façade : ${surface.toFixed(2)} m²<br>
                Type d'habitation : ${housingType === "standard" ? "Habitation standard" : "Maison comportant un logement accessoire"}<br>
                Type de revêtement : ${revetingType === "combustible" ? "Combustible" : "Incombustible"}<br>
                <br><strong>Détails d'interpolation :</strong><br>
                Distance limitative entre ${lowerDistance} m et ${upperDistance} m<br>
                Surface de référence entre ${lowerSurface === upperSurface ? lowerSurface : lowerSurface + " m² et " + upperSurface + " m²"}<br>
                <br><strong>Résultats :</strong><br>
                Pourcentage maximal de baies non protégées : ${finalPercentage.toFixed(2)}%<br>
                Surface maximale de baies non protégées : ${maxArea.toFixed(2)} m²
                ${constructionRequirements}
                ${housingInfo}
            `;

            document.getElementById('method91015-result').innerHTML = resultHTML;
        }

        function openTab(event, tabName) {
            var tabcontent = document.getElementsByClassName("tab-content");
            for (var i = 0; i < tabcontent.length; i++) {
                tabcontent[i].classList.remove("active");
            }
            var tablinks = document.getElementsByClassName("tab-link");
            for (var i = 0; i < tablinks.length; i++) {
                tablinks[i].classList.remove("active");
            }
            document.getElementById(tabName).classList.add("active");
            event.currentTarget.classList.add("active");
        }
    // Ajouter un écouteur d'événement pour la touche Enter
document.addEventListener('keypress', function(event) {
    if (event.key === 'Enter') {
        // Déterminer quel onglet est actif
        const activeTab = document.querySelector('.tab-content.active');
        if (activeTab.id === 'cnb') {
            calculateCNB();
        } else if (activeTab.id === 'method91014') {
            calculate91014();
        } else if (activeTab.id === 'method91015') {
            calculate91015();
        }
    }
});function duplicatePanel() {
    // Vérifiez s'il y a déjà un deuxième panneau
    if (document.getElementById('panel-2')) {
        alert("Un maximum de deux façades peut être calculé simultanément.");
        return;
    }
    
    // Cloner le premier panneau
    const panel1 = document.getElementById('panel-1');
    const panel2 = panel1.cloneNode(true);
    panel2.id = 'panel-2';
    
    // Mettre à jour le titre
    panel2.querySelector('.panel-title').textContent = 'Façade de rayonnement #2';
    
    // Mettre à jour les IDs des éléments internes
    panel2.querySelectorAll('[id]').forEach(element => {
        if (element.id !== 'panel-2') {
            element.id = element.id + '-p2';
        }
    });
    
    // Ajouter le nouveau panneau
    document.querySelector('.panels-container').appendChild(panel2);
    
    // Mettre à jour les gestionnaires d'événements
    panel2.querySelectorAll('button').forEach(button => {
        if (button.onclick) {
            const onclickStr = button.getAttribute('onclick');
            if (onclickStr.includes('calculate')) {
                button.setAttribute('onclick', onclickStr.replace(')', '-p2)'));
            } else if (onclickStr.includes('openTab')) {
                const newOnclick = onclickStr.replace('openTab(event, ', 'openTab(event, ') + '-p2';
                button.setAttribute('onclick', newOnclick);
            }
        }
    });
}</script>
