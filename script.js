// Tableau 3.2.3.1.-B - Usages des groupes A, B3, C, D et F3 - Sans gicleurs
   const tableauGroupesAB3CDF3 = {
       10: {
           "< 3:1": [0, 8, 10, 18, 29, 46, 91, 100],
           "3:1 à 10:1": [0, 8, 12, 21, 33, 50, 96, 100],
           "> 10:1": [0, 11, 18, 32, 48, 68, 100]
       },
       15: {
           "< 3:1": [0, 7, 9, 14, 22, 33, 63, 100],
           "3:1 à 10:1": [0, 8, 10, 17, 25, 37, 67, 100],
           "> 10:1": [0, 10, 15, 26, 39, 53, 87, 100]
       },
       20: {
           "< 3:1": [0, 7, 9, 12, 18, 26, 49, 81, 100],
           "3:1 à 10:1": [0, 8, 10, 15, 21, 30, 53, 85, 100],
           "> 10:1": [0, 9, 14, 23, 33, 45, 72, 100]
       },
       25: {
           "< 3:1": [0, 7, 8, 11, 16, 23, 41, 66, 98, 100],
           "3:1 à 10:1": [0, 8, 9, 13, 19, 26, 45, 70, 100],
           "> 10:1": [0, 9, 13, 21, 30, 39, 62, 90, 100]
       },
       30: {
           "< 3:1": [0, 7, 8, 11, 15, 20, 35, 56, 83, 100],
           "3:1 à 10:1": [0, 7, 9, 12, 17, 23, 39, 61, 88, 100],
           "> 10:1": [0, 8, 12, 19, 27, 36, 56, 79, 100]
       },
       40: {
           "< 3:1": [0, 7, 8, 10, 13, 17, 28, 44, 64, 89, 100],
           "3:1 à 10:1": [0, 7, 8, 11, 15, 20, 32, 48, 69, 93, 100],
           "> 10:1": [0, 8, 11, 17, 24, 31, 47, 66, 88, 100]
       },
       50: {
           "< 3:1": [0, 7, 8, 9, 12, 15, 24, 37, 53, 72, 96, 100],
           "3:1 à 10:1": [0, 7, 8, 10, 14, 18, 28, 41, 57, 77, 100],
           "> 10:1": [0, 8, 10, 15, 21, 28, 41, 57, 76, 97, 100]
       },
       60: {
           "< 3:1": [0, 7, 8, 9, 11, 14, 21, 32, 45, 62, 81, 100],
           "3:1 à 10:1": [0, 7, 8, 10, 13, 16, 25, 36, 49, 66, 85, 100],
           "> 10:1": [0, 8, 10, 14, 20, 25, 38, 51, 67, 85, 100]
       },
       80: {
           "< 3:1": [0, 7, 7, 8, 10, 12, 18, 26, 36, 48, 62, 79, 98, 100],
           "3:1 à 10:1": [0, 7, 8, 9, 11, 14, 21, 29, 40, 52, 67, 84, 100],
           "> 10:1": [0, 8, 9, 13, 17, 22, 32, 44, 56, 70, 86, 100]
       },
       100: {
           "< 3:1": [0, 7, 7, 8, 9, 11, 16, 22, 30, 40, 51, 65, 80, 97, 100],
           "3:1 à 10:1": [0, 7, 8, 9, 11, 13, 18, 25, 34, 44, 56, 69, 84, 100],
           "> 10:1": [0, 7, 9, 12, 16, 20, 29, 39, 49, 61, 74, 89, 100]
       },
       150: {
           "< 3:1": [0, 7, 7, 8, 9, 10, 13, 17, 22, 29, 37, 46, 56, 67, 79, 93, 100],
           "3:1 à 10:1": [0, 7, 7, 8, 10, 11, 15, 20, 26, 33, 41, 50, 60, 71, 84, 97, 100],
           "> 10:1": [0, 7, 8, 11, 13, 17, 24, 31, 39, 48, 57, 68, 79, 91, 100]
       },
       250: {
           "< 3:1": [0, 7, 7, 7, 8, 9, 10, 13, 16, 20, 25, 30, 36, 43, 51, 59, 68, 87, 100],
           "3:1 à 10:1": [0, 7, 7, 8, 9, 10, 12, 15, 19, 24, 28, 34, 40, 47, 55, 63, 72, 92, 100],
           "> 10:1": [0, 7, 8, 9, 11, 14, 19, 24, 30, 36, 43, 50, 57, 65, 73, 82, 92, 100]
       },
       350: {
           "< 3:1": [0, 7, 7, 7, 8, 8, 9, 11, 14, 16, 20, 24, 28, 33, 38, 44, 50, 64, 81, 99, 100],
           "3:1 à 10:1": [0, 7, 7, 8, 8, 9, 11, 13, 16, 19, 23, 27, 32, 37, 42, 48, 55, 69, 85, 100],
           "> 10:1": [0, 7, 8, 9, 10, 12, 16, 21, 25, 30, 36, 41, 47, 53, 59, 66, 73, 88, 100]
       },
       500: {
           "< 3:1": [0, 7, 7, 7, 7, 8, 9, 10, 12, 14, 16, 19, 22, 25, 29, 33, 37, 47, 59, 71, 100],
           "3:1 à 10:1": [0, 7, 7, 7, 8, 8, 10, 12, 14, 16, 19, 22, 25, 29, 33, 37, 41, 52, 63, 76, 100],
           "> 10:1": [0, 7, 7, 8, 9, 11, 14, 18, 22, 25, 30, 34, 38, 43, 48, 53, 58, 70, 82, 96, 100]
       },
       1000: {
           "< 3:1": [0, 7, 7, 7, 7, 7, 8, 9, 9, 10, 12, 13, 14, 16, 18, 20, 22, 27, 33, 39, 58, 82, 100],
           "3:1 à 10:1": [0, 7, 7, 7, 7, 8, 9, 10, 11, 12, 14, 15, 17, 19, 21, 23, 26, 31, 37, 43, 63, 86, 100],
           "> 10:1": [0, 7, 7, 8, 8, 9, 11, 13, 16, 19, 21, 24, 27, 30, 33, 36, 39, 46, 53, 60, 82, 100]
       },
       2000: {
           "< 3:1": [0, 7, 7, 7, 7, 7, 7, 8, 8, 9, 9, 10, 11, 12, 13, 14, 15, 17, 20, 23, 33, 44, 58, 74, 93, 100],
           "3:1 à 10:1": [0, 7, 7, 7, 7, 7, 8, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 20, 23, 27, 37, 49, 63, 79, 97, 100],
           "> 10:1": [0, 7, 7, 7, 8, 8, 9, 11, 12, 14, 16, 18, 19, 21, 23, 25, 27, 32, 36, 40, 53, 66, 82, 99, 100]
       }
   };
   
   // Tableau 3.2.3.1.-C - Usages des groupes E, F1 et F2 - Sans gicleurs
   const tableauGroupesEF1F2 = {
       10: {
           "< 3:1": [0, 4, 5, 9, 15, 23, 46, 77, 100],
           "3:1 à 10:1": [0, 4, 6, 10, 17, 25, 48, 79, 100],
           "> 10:1": [0, 5, 9, 16, 24, 34, 58, 91, 100]
       },
       15: {
           "< 3:1": [0, 4, 5, 7, 11, 16, 32, 53, 79, 100],
           "3:1 à 10:1": [0, 4, 5, 8, 13, 18, 34, 55, 82, 100],
           "> 10:1": [0, 5, 8, 13, 19, 26, 43, 66, 93, 100]
       },
       20: {
           "< 3:1": [0, 4, 4, 6, 9, 13, 25, 40, 61, 85, 100],
           "3:1 à 10:1": [0, 4, 5, 7, 11, 15, 27, 43, 63, 87, 100],
           "> 10:1": [0, 5, 7, 11, 17, 22, 36, 53, 74, 99, 100]
       },
       25: {
           "< 3:1": [0, 4, 4, 6, 8, 11, 20, 33, 49, 69, 92, 100],
           "3:1 à 10:1": [0, 4, 5, 7, 9, 13, 22, 35, 51, 71, 94, 100],
           "> 10:1": [0, 4, 6, 10, 15, 20, 31, 45, 62, 82, 100]
       },
       30: {
           "< 3:1": [0, 4, 4, 5, 7, 10, 18, 28, 42, 58, 77, 100],
           "3:1 à 10:1": [0, 4, 4, 6, 9, 12, 20, 30, 44, 60, 80, 100],
           "> 10:1": [0, 4, 6, 10, 14, 18, 28, 40, 54, 71, 91, 100]
       },
       40: {
           "< 3:1": [0, 4, 4, 5, 6, 8, 14, 22, 32, 44, 59, 76, 94, 100],
           "3:1 à 10:1": [0, 4, 4, 6, 8, 10, 16, 24, 34, 47, 61, 78, 97, 100],
           "> 10:1": [0, 4, 5, 8, 12, 15, 23, 33, 44, 57, 72, 89, 100]
       },
       50: {
           "< 3:1": [0, 4, 4, 5, 6, 7, 12, 18, 26, 36, 48, 61, 76, 93, 100],
           "3:1 à 10:1": [0, 4, 4, 5, 7, 9, 14, 20, 29, 38, 50, 63, 79, 95, 100],
           "> 10:1": [0, 4, 5, 8, 11, 14, 21, 29, 38, 48, 61, 74, 90, 100]
       },
       60: {
           "< 3:1": [0, 4, 4, 4, 5, 7, 11, 16, 23, 31, 40, 52, 64, 78, 94, 100],
           "3:1 à 10:1": [0, 4, 4, 5, 6, 8, 12, 18, 25, 33, 43, 54, 66, 81, 96, 100],
           "> 10:1": [0, 4, 5, 7, 10, 13, 19, 26, 34, 43, 53, 64, 77, 92, 100]
       },
       80: {
           "< 3:1": [0, 4, 4, 4, 5, 6, 9, 13, 18, 24, 31, 40, 49, 60, 71, 84, 98, 100],
           "3:1 à 10:1": [0, 4, 4, 5, 6, 7, 10, 15, 20, 26, 33, 42, 51, 62, 74, 86, 100],
           "> 10:1": [0, 4, 5, 6, 9, 11, 16, 22, 28, 35, 43, 52, 62, 73, 85, 98, 100]
       },
       100: {
           "< 3:1": [0, 4, 4, 4, 5, 5, 8, 11, 15, 20, 26, 32, 40, 48, 58, 68, 79, 100],
           "3:1 à 10:1": [0, 4, 4, 4, 5, 6, 9, 13, 17, 22, 28, 35, 42, 51, 60, 70, 81, 100],
           "> 10:1": [0, 4, 4, 6, 8, 10, 14, 19, 25, 31, 37, 44, 52, 61, 71, 81, 92, 100]
       },
       150: {
           "< 3:1": [0, 4, 4, 4, 4, 5, 6, 8, 11, 14, 18, 23, 28, 33, 40, 46, 54, 70, 89, 100],
           "3:1 à 10:1": [0, 4, 4, 4, 5, 6, 8, 10, 13, 16, 20, 25, 30, 36, 42, 49, 56, 73, 92, 100],
           "> 10:1": [0, 4, 4, 5, 7, 8, 12, 16, 20, 24, 29, 34, 39, 46, 52, 59, 67, 84, 100]
       },
       250: {
           "< 3:1": [0, 4, 4, 4, 4, 4, 5, 7, 8, 10, 12, 15, 18, 22, 25, 29, 34, 44, 55, 68, 100],
           "3:1 à 10:1": [0, 4, 4, 4, 4, 5, 6, 8, 10, 12, 14, 17, 20, 24, 27, 32, 36, 46, 57, 70, 100],
         "> 10:1": [0, 4, 4, 5, 6, 7, 9, 12, 15, 18, 21, 25, 28, 32, 37, 41, 46, 56, 68, 81, 100]
       },
       350: {
           "< 3:1": [0, 4, 4, 4, 4, 4, 5, 6, 7, 8, 10, 12, 14, 16, 19, 22, 25, 32, 40, 49, 77, 100],
           "3:1 à 10:1": [0, 4, 4, 4, 4, 4, 5, 7, 8, 10, 12, 14, 16, 18, 21, 24, 27, 34, 43, 52, 79, 100],
           "> 10:1": [0, 4, 4, 4, 5, 6, 8, 10, 13, 15, 18, 21, 23, 26, 30, 33, 36, 44, 53, 62, 90, 100]
       },
       500: {
           "< 3:1": [0, 4, 4, 4, 4, 4, 4, 5, 6, 7, 8, 9, 11, 13, 14, 16, 19, 24, 29, 36, 55, 78, 100],
           "3:1 à 10:1": [0, 4, 4, 4, 4, 4, 5, 6, 7, 8, 9, 11, 13, 14, 16, 18, 21, 26, 31, 38, 57, 80, 100],
           "> 10:1": [0, 4, 4, 4, 5, 5, 7, 9, 11, 13, 15, 17, 19, 21, 24, 26, 29, 35, 41, 48, 68, 92, 100]
       },
       1000: {
           "< 3:1": [0, 4, 4, 4, 4, 4, 4, 4, 5, 5, 6, 6, 7, 8, 9, 10, 11, 14, 16, 20, 29, 41, 55, 71, 89, 100],
           "3:1 à 10:1": [0, 4, 4, 4, 4, 4, 4, 5, 5, 6, 7, 8, 9, 10, 11, 12, 13, 15, 18, 22, 31, 43, 57, 73, 91, 100],
           "> 10:1": [0, 4, 4, 4, 4, 5, 6, 7, 8, 9, 11, 12, 13, 15, 16, 18, 20, 23, 26, 30, 41, 53, 68, 84, 100]
       },
       2000: {
           "< 3:1": [0, 4, 4, 4, 4, 4, 4, 4, 4, 4, 5, 5, 5, 6, 6, 7, 7, 9, 10, 12, 16, 22, 29, 37, 46, 56, 68, 80, 94, 100],
           "3:1 à 10:1": [0, 4, 4, 4, 4, 4, 4, 4, 5, 5, 5, 6, 6, 7, 7, 8, 9, 10, 12, 13, 18, 24, 31, 39, 49, 59, 70, 83, 96, 100],
           "> 10:1": [0, 4, 4, 4, 4, 4, 5, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 16, 18, 20, 26, 33, 41, 50, 59, 70, 81, 94, 100]
       }
   };
   
   // Tableau 3.2.3.1.-D - Bâtiment protégé par gicleurs - Usages des groupes A, B, C, D et F3
   const tableauAvecGicleursGroupesABCDF3 = {
       10: [0, 16, 24, 42, 66, 100],
       15: [0, 16, 20, 34, 50, 74, 100],
       20: [0, 16, 20, 30, 42, 60, 100],
       25: [0, 16, 18, 26, 38, 52, 90, 100],
       30: [0, 14, 18, 24, 34, 46, 78, 100],
       40: [0, 14, 16, 22, 30, 40, 64, 96, 100],
       50: [0, 14, 16, 20, 28, 36, 56, 82, 100],
       60: [0, 14, 16, 20, 26, 32, 50, 72, 98, 100],
       80: [0, 14, 16, 18, 22, 28, 42, 58, 80, 100],
       100: [0, 14, 16, 18, 22, 26, 36, 50, 68, 88, 100],
       150: [0, 14, 14, 16, 20, 22, 30, 40, 52, 66, 82, 100]
   };
   
   // Tableau 3.2.3.1.-E - Bâtiment protégé par gicleurs - Usages des groupes E, F1 et F2
   const tableauAvecGicleursGroupesEF1F2 = {
       10: [0, 8, 12, 20, 34, 50, 96, 100],
       15: [0, 8, 10, 16, 26, 36, 68, 100],
       20: [0, 8, 10, 14, 22, 30, 54, 86, 100],
       25: [0, 8, 10, 14, 18, 26, 44, 70, 100],
       30: [0, 8, 8, 12, 18, 24, 40, 60, 88, 100],
       40: [0, 8, 8, 12, 16, 20, 32, 48, 68, 94, 100],
       50: [0, 8, 8, 10, 14, 18, 28, 40, 58, 76, 100],
       60: [0, 8, 8, 10, 12, 16, 24, 36, 50, 66, 86, 100],
       80: [0, 8, 8, 10, 12, 14, 20, 30, 40, 52, 66, 84, 100],
       100: [0, 8, 8, 8, 10, 12, 18, 26, 34, 44, 56, 70, 84, 100],
       150: [0, 8, 8, 8, 10, 12, 16, 20, 26, 32, 40, 50, 60, 72, 84, 98, 100],
       200: [0, 8, 8, 8, 8, 10, 14, 18, 22, 28, 34, 42,50, 60, 68, 80, 92, 100]
   };

   const limitingDistancesNoSprinklers = [0, 1.2, 1.5, 2.0, 2.5, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 16, 18, 20, 25, 30, 35, 40, 45, 50, 55, 60, 65, 70];
   const limitingDistancesWithSprinklersABCDF3 = [0, 1.2, 1.5, 2.0, 2.5, 3, 4, 5, 6, 7, 8, 9];
   const limitingDistancesWithSprinklersEF1F2 = [0, 1.2, 1.5, 2.0, 2.5, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15];
   const facadeSurfaces = [10, 15, 20, 25, 30, 40, 50, 60, 80, 100, 150, 250, 350, 500, 1000, 2000];
   const facadeSurfacesWithSprinklersABCDF3 = [10, 15, 20, 25, 30, 40, 50, 60, 80, 100, 150, 250, 350, 500, 1000, 2000];
   const facadeSurfacesWithSprinklersEF1F2 = [10, 15, 20, 25, 30, 40, 50, 60, 80, 100, 150, 200];

// Données du Tableau 9.10.14.4-A
const tableau91014 = {
    "habitation": {
        surfaces: {
            30: [0, 7, 9, 12, 39, 88, 100, 100, 100, 100, 100, 100, 100],
            40: [0, 7, 8, 11, 32, 69, 100, 100, 100, 100, 100, 100, 100],
            50: [0, 7, 8, 10, 28, 57, 100, 100, 100, 100, 100, 100, 100],
            100: [0, 7, 8, 9, 18, 34, 56, 84, 100, 100, 100, 100, 100],
            ">100": [0, 7, 7, 8, 12, 19, 28, 40, 55, 92, 100, 100, 100]
        },
        distances: [0, 1.2, 1.5, 2.0, 4.0, 6.0, 8.0, 10.0, 12.0, 16.0, 20.0, 25.0, 30.0]
    },
    "commercial": {
        surfaces: {
            30: [0, 4, 4, 6, 20, 44, 80, 100, 100, 100, 100, 100, 100],
            40: [0, 4, 4, 6, 16, 34, 61, 97, 100, 100, 100, 100, 100],
            50: [0, 4, 4, 5, 14, 29, 50, 79, 100, 100, 100, 100, 100],
            100: [0, 4, 4, 4, 9, 17, 28, 42, 60, 100, 100, 100, 100],
            ">100": [0, 4, 4, 4, 6, 10, 14, 20, 27, 46, 70, 100, 100]
        },
        distances: [0, 1.2, 1.5, 2.0, 4.0, 6.0, 8.0, 10.0, 12.0, 16.0, 20.0, 25.0, 30.0]
    }
};

// Données du Tableau 9.10.15.4
const tableau91015 = {
    surfaces: {
        30: [0, 7, 9, 12, 39, 88, 100, 100, 100, 100, 100],
        40: [0, 7, 8, 11, 32, 69, 100, 100, 100, 100, 100],
        50: [0, 7, 8, 10, 28, 57, 100, 100, 100, 100, 100],
        100: [0, 7, 8, 9, 18, 34, 56, 84, 100, 100, 100],
        ">100": [0, 7, 7, 8, 12, 19, 28, 40, 55, 92, 100]
    },
    distances: [0, 1.2, 1.5, 2.0, 4.0, 6.0, 8.0, 10.0, 12.0, 16.0, 20.0]
};

   // Afficher/masquer les options supplémentaires
   document.addEventListener('DOMContentLoaded', function() {
       // Gestionnaires d'événements pour les checkboxes de vérification d'espacement
       document.getElementById('check_spacing_cnb').addEventListener('change', function() {
           document.getElementById('spacing_options_cnb').style.display = this.checked ? 'block' : 'none';
       });
                       
       document.getElementById('check_spacing_91014').addEventListener('change', function() {
           document.getElementById('spacing_options_91014').style.display = this.checked ? 'block' : 'none';
       });
       
       document.getElementById('check_spacing_91015').addEventListener('change', function() {
               document.getElementById('spacing_options_91015').style.display = this.checked ? 'block' : 'none';
           });
           
           // Gestionnaires d'événements pour les checkboxes de vérification des soffites
           document.getElementById('check_soffit_cnb').addEventListener('change', function() {
               document.getElementById('soffit_options_cnb').style.display = this.checked ? 'block' : 'none';
           });
           
           document.getElementById('check_soffit_91014').addEventListener('change', function() {
               document.getElementById('soffit_options_91014').style.display = this.checked ? 'block' : 'none';
           });
           
           document.getElementById('check_soffit_91015').addEventListener('change', function() {
               document.getElementById('soffit_options_91015').style.display = this.checked ? 'block' : 'none';
           });
           
           // Gestionnaire d'événement pour la méthode de l'aire pondérée
           document.getElementById('weighted_area_cnb').addEventListener('change', function() {
               document.getElementById('weighted_options_cnb').style.display = this.checked ? 'block' : 'none';
           });
           
           // Ajouter des écouteurs pour l'onglet CNB
           const cnbInputs = document.querySelectorAll('#cnb input[type="number"]');
           cnbInputs.forEach(input => {
               input.addEventListener('keypress', function(event) {
                   handleEnterKey(event, calculateCNB);
               });
           });

           // Ajouter des écouteurs pour l'onglet 9.10.14
           const inputs91014 = document.querySelectorAll('#method91014 input[type="number"]');
           inputs91014.forEach(input => {
               input.addEventListener('keypress', function(event) {
                   handleEnterKey(event, calculate91014);
               });
           });

           // Ajouter des écouteurs pour l'onglet 9.10.15
           const inputs91015 = document.querySelectorAll('#method91015 input[type="number"]');
           inputs91015.forEach(input => {
               input.addEventListener('keypress', function(event) {
                   handleEnterKey(event, calculate91015);
               });
           });
       });

// Fonction pour déterminer la catégorie du rapport L/H
function determinerRapportLH(longueur, hauteur) {
    const rapportLH = longueur / hauteur;
    const rapportHL = hauteur / longueur;
    const maxRapport = Math.max(rapportLH, rapportHL);
    
    if (maxRapport < 3) return "< 3:1";
    if (maxRapport <= 10) return "3:1 à 10:1";
    return "> 10:1";
}

// Fonction pour trouver les valeurs encadrantes dans un tableau
function trouverValeurEncadrantes(valeur, tableau) {
    // Si la valeur est inférieure au premier élément
    if (valeur <= tableau[0]) {
        return { inferieure: tableau[0], superieure: tableau[0] };
    }
    
    // Si la valeur est supérieure au dernier élément
    if (valeur >= tableau[tableau.length - 1]) {
        return { inferieure: tableau[tableau.length - 1], superieure: tableau[tableau.length - 1] };
    }
    
    // Rechercher les bornes encadrantes
    for (let i = 0; i < tableau.length - 1; i++) {
        if (valeur >= tableau[i] && valeur <= tableau[i + 1]) {
            return { inferieure: tableau[i], superieure: tableau[i + 1] };
        }
    }
    
    // En cas d'échec (ne devrait jamais arriver si les vérifications ci-dessus sont correctes)
    return { inferieure: tableau[0], superieure: tableau[1] };
}

// Fonction d'interpolation principale qui suit exactement la méthodologie de référence
function interpolationCNB(usage, distanceLimitative, surfaceFacade, rapportLH, avecGicleurs) {
    // Déterminer les tableaux à utiliser en fonction de l'usage et de la présence de gicleurs
    let tableauUtilise, distancesUtilisees, surfacesUtilisees;
    
    if (avecGicleurs) {
        if (usage === "groupes_A_B3_C_D_F3") {
            tableauUtilise = tableauAvecGicleursGroupesABCDF3;
            distancesUtilisees = limitingDistancesWithSprinklersABCDF3;
            surfacesUtilisees = facadeSurfacesWithSprinklersABCDF3;
        } else { // groupes_E_F1_F2
            tableauUtilise = tableauAvecGicleursGroupesEF1F2;
            distancesUtilisees = limitingDistancesWithSprinklersEF1F2;
            surfacesUtilisees = facadeSurfacesWithSprinklersEF1F2;
        }
    } else {
        distancesUtilisees = limitingDistancesNoSprinklers;
        surfacesUtilisees = facadeSurfaces;
        if (usage === "groupes_A_B3_C_D_F3") {
            tableauUtilise = tableauGroupesAB3CDF3;
        } else { // groupes_E_F1_F2
            tableauUtilise = tableauGroupesEF1F2;
        }
    }
    
    // Vérifier si la distance limitative dépasse la plage du tableau
    if (distanceLimitative > distancesUtilisees[distancesUtilisees.length - 1]) {
        return 100; // 100% de baies non protégées autorisées
    }
    
    // ÉTAPE 0: Trouver les bornes d'encadrement pour la distance limitative
    const distancesEncadrantes = trouverValeurEncadrantes(distanceLimitative, distancesUtilisees);
    const distanceInferieure = distancesEncadrantes.inferieure;
    const distanceSuperieure = distancesEncadrantes.superieure;
    const distanceInferieureIndex = distancesUtilisees.indexOf(distanceInferieure);
    const distanceSuperieureIndex = distancesUtilisees.indexOf(distanceSuperieure);
    
    // Trouver les surfaces encadrantes pour la façade de rayonnement
    const surfacesEncadrantes = trouverValeurEncadrantes(surfaceFacade, surfacesUtilisees);
    const surfaceInferieure = surfacesEncadrantes.inferieure;
    const surfaceSuperieure = surfacesEncadrantes.superieure;
    
    // Si les distances sont identiques, pas besoin d'interpolation complexe
    if (distanceInferieure === distanceSuperieure) {
        return interpolationSurfaceUniquement(tableauUtilise, surfaceFacade, surfaceInferieure, 
               surfaceSuperieure, distanceInferieureIndex, rapportLH, avecGicleurs);
    }
    
    // Si les surfaces sont identiques, pas besoin d'interpolation complexe
    if (surfaceInferieure === surfaceSuperieure) {
        return interpolationDistanceUniquement(tableauUtilise, distanceLimitative, distanceInferieure, 
               distanceSuperieure, surfaceInferieure, distanceInferieureIndex, 
               distanceSuperieureIndex, rapportLH, avecGicleurs);
    }
    
    // ÉTAPE 1: Interpolation selon la distance limitative inférieure
    let pourcentageDistanceInferieure;
    if (!avecGicleurs) {
        // Obtenir les pourcentages du tableau selon la distance limitative inférieure
        const pourcentageSurfSupDistInf = tableauUtilise[surfaceSuperieure][rapportLH][distanceInferieureIndex];
        const pourcentageSurfInfDistInf = tableauUtilise[surfaceInferieure][rapportLH][distanceInferieureIndex];
        
        // Formule d'interpolation pour l'étape 1 exactement comme dans l'exemple
        pourcentageDistanceInferieure = pourcentageSurfSupDistInf + 
            ((surfaceFacade - surfaceInferieure) / (surfaceSuperieure - surfaceInferieure)) * 
            (pourcentageSurfInfDistInf - pourcentageSurfSupDistInf);
    } else {
        // Cas avec gicleurs (pas de ratio)
        const pourcentageSurfSupDistInf = tableauUtilise[surfaceSuperieure][distanceInferieureIndex];
        const pourcentageSurfInfDistInf = tableauUtilise[surfaceInferieure][distanceInferieureIndex];
        
        pourcentageDistanceInferieure = pourcentageSurfSupDistInf + 
            ((surfaceFacade - surfaceInferieure) / (surfaceSuperieure - surfaceInferieure)) * 
            (pourcentageSurfInfDistInf - pourcentageSurfSupDistInf);
    }
    
    // ÉTAPE 2: Interpolation selon la distance limitative supérieure
    let pourcentageDistanceSuperieure;
    if (!avecGicleurs) {
        // Obtenir les pourcentages du tableau selon la distance limitative supérieure
        const pourcentageSurfSupDistSup = tableauUtilise[surfaceSuperieure][rapportLH][distanceSuperieureIndex];
        const pourcentageSurfInfDistSup = tableauUtilise[surfaceInferieure][rapportLH][distanceSuperieureIndex];
        
        // Formule d'interpolation pour l'étape 2 exactement comme dans l'exemple
        pourcentageDistanceSuperieure = pourcentageSurfSupDistSup + 
            ((surfaceFacade - surfaceInferieure) / (surfaceSuperieure - surfaceInferieure)) * 
            (pourcentageSurfInfDistSup - pourcentageSurfSupDistSup);
    } else {
        // Cas avec gicleurs (pas de ratio)
        const pourcentageSurfSupDistSup = tableauUtilise[surfaceSuperieure][distanceSuperieureIndex];
        const pourcentageSurfInfDistSup = tableauUtilise[surfaceInferieure][distanceSuperieureIndex];
        
        pourcentageDistanceSuperieure = pourcentageSurfSupDistSup + 
            ((surfaceFacade - surfaceInferieure) / (surfaceSuperieure - surfaceInferieure)) * 
            (pourcentageSurfInfDistSup - pourcentageSurfSupDistSup);
    }
    
    // ÉTAPE 3: Interpolation finale entre les deux résultats d'interpolation précédents
    const pourcentageFinal = pourcentageDistanceInferieure + 
        ((distanceLimitative - distanceInferieure) / (distanceSuperieure - distanceInferieure)) * 
        (pourcentageDistanceSuperieure - pourcentageDistanceInferieure);
    
    // Limiter le pourcentage final entre 0 et 100
    return Math.max(0, Math.min(100, pourcentageFinal));
}

// Fonction pour l'interpolation quand seule la surface varie (distance unique)
function interpolationSurfaceUniquement(tableauUtilise, surfaceFacade, surfaceInferieure, 
                                       surfaceSuperieure, distanceIndex, rapportLH, avecGicleurs) {
    let pourcentageSurfInf, pourcentageSurfSup;
    
    if (!avecGicleurs) {
        pourcentageSurfInf = tableauUtilise[surfaceInferieure][rapportLH][distanceIndex];
        pourcentageSurfSup = tableauUtilise[surfaceSuperieure][rapportLH][distanceIndex];
    } else {
        pourcentageSurfInf = tableauUtilise[surfaceInferieure][distanceIndex];
        pourcentageSurfSup = tableauUtilise[surfaceSuperieure][distanceIndex];
    }
    
    // Si les surfaces sont identiques, retourner directement la valeur
    if (surfaceInferieure === surfaceSuperieure) {
        return pourcentageSurfInf;
    }
    
    // Interpolation linéaire entre les surfaces
    return pourcentageSurfSup + 
        ((surfaceFacade - surfaceInferieure) / (surfaceSuperieure - surfaceInferieure)) * 
        (pourcentageSurfInf - pourcentageSurfSup);
}

// Fonction pour l'interpolation quand seule la distance varie (surface unique)
function interpolationDistanceUniquement(tableauUtilise, distanceLimitative, distanceInferieure, 
                                        distanceSuperieure, surface, distanceInferieureIndex, 
                                        distanceSuperieureIndex, rapportLH, avecGicleurs) {
    let pourcentageDistInf, pourcentageDistSup;
    
    if (!avecGicleurs) {
        pourcentageDistInf = tableauUtilise[surface][rapportLH][distanceInferieureIndex];
        pourcentageDistSup = tableauUtilise[surface][rapportLH][distanceSuperieureIndex];
    } else {
        pourcentageDistInf = tableauUtilise[surface][distanceInferieureIndex];
        pourcentageDistSup = tableauUtilise[surface][distanceSuperieureIndex];
    }
    
    // Si les distances sont identiques, retourner directement la valeur
    if (distanceInferieure === distanceSuperieure) {
        return pourcentageDistInf;
    }
    
    // Interpolation linéaire entre les distances
    return pourcentageDistInf + 
        ((distanceLimitative - distanceInferieure) / (distanceSuperieure - distanceInferieure)) * 
        (pourcentageDistSup - pourcentageDistInf);
}

// Fonction principale pour calculer avec la méthode CNB
function calculerPourcentageCNB(usage, distanceLimitative, surfaceFacade, longueur, hauteur, avecGicleurs, avecMajoration) {
    // Déterminer le rapport L/H
    const rapportLH = determinerRapportLH(longueur, hauteur);
    
    // Calculer le pourcentage de base
    let pourcentage = interpolationCNB(usage, distanceLimitative, surfaceFacade, rapportLH, avecGicleurs);
    
    // Appliquer la majoration si nécessaire (briques de verre, verre armé)
    if (avecMajoration) {
        pourcentage = Math.min(100, pourcentage * 2);
    }
    
    return pourcentage;
}

// Fonction pour le calcul selon 9.10.14.4 ou 9.10.15.4
function calculerPourcentage910x(tableau, distanceLimitative, surfaceFacade, avecGicleurs, avecMajoration) {
    const distances = tableau.distances;
    
    // Vérifier si la distance limitative est supérieure à la plage du tableau
    if (distanceLimitative > distances[distances.length - 1]) {
        return 100; // 100% de baies non protégées autorisées
    }
    
    // Trouver les distances encadrantes
    const distancesEncadrantes = trouverValeurEncadrantes(distanceLimitative, distances);
    const distanceInferieure = distancesEncadrantes.inferieure;
    const distanceSuperieure = distancesEncadrantes.superieure;
    const distanceInferieureIndex = distances.indexOf(distanceInferieure);
    const distanceSuperieureIndex = distances.indexOf(distanceSuperieure);
    
    // Déterminer les surfaces disponibles dans le tableau
    const surfacesDisponibles = Object.keys(tableau.surfaces).filter(s => s !== ">100").map(Number);
    
    // Trouver les surfaces encadrantes
    let surfaceInferieure, surfaceSuperieure;
    
    if (surfaceFacade <= surfacesDisponibles[0]) {
        surfaceInferieure = surfacesDisponibles[0];
        surfaceSuperieure = surfacesDisponibles[1];
    } else if (surfaceFacade > surfacesDisponibles[surfacesDisponibles.length - 1]) {
        surfaceInferieure = surfacesDisponibles[surfacesDisponibles.length - 1];
        surfaceSuperieure = ">100";
    } else {
        for (let i = 0; i < surfacesDisponibles.length - 1; i++) {
            if (surfaceFacade > surfacesDisponibles[i] && surfaceFacade <= surfacesDisponibles[i + 1]) {
                surfaceInferieure = surfacesDisponibles[i];
                surfaceSuperieure = surfacesDisponibles[i + 1];
                break;
            }
        }
    }
    
    // ÉTAPE 1: Interpolation selon la distance limitative inférieure
    let pourcentageDistanceInferieure;
    if (surfaceSuperieure === ">100") {
        pourcentageDistanceInferieure = tableau.surfaces[surfaceInferieure][distanceInferieureIndex];
    } else {
        const pourcentageSurfInfDistInf = tableau.surfaces[surfaceInferieure][distanceInferieureIndex];
        const pourcentageSurfSupDistInf = tableau.surfaces[surfaceSuperieure][distanceInferieureIndex];
        
        pourcentageDistanceInferieure = pourcentageSurfInfDistInf + 
            ((surfaceFacade - surfaceInferieure) / (surfaceSuperieure - surfaceInferieure)) * 
            (pourcentageSurfSupDistInf - pourcentageSurfInfDistInf);
    }
    
    // ÉTAPE 2: Interpolation selon la distance limitative supérieure
    let pourcentageDistanceSuperieure;
    if (surfaceSuperieure === ">100") {
        pourcentageDistanceSuperieure = tableau.surfaces[surfaceInferieure][distanceSuperieureIndex];
    } else {
        const pourcentageSurfInfDistSup = tableau.surfaces[surfaceInferieure][distanceSuperieureIndex];
        const pourcentageSurfSupDistSup = tableau.surfaces[surfaceSuperieure][distanceSuperieureIndex];
        
        pourcentageDistanceSuperieure = pourcentageSurfInfDistSup + 
            ((surfaceFacade - surfaceInferieure) / (surfaceSuperieure - surfaceInferieure)) * 
            (pourcentageSurfSupDistSup - pourcentageSurfInfDistSup);
    }
    
    // ÉTAPE 3: Interpolation finale entre les deux résultats d'interpolation précédents
    let pourcentageFinal = pourcentageDistanceInferieure + 
        ((distanceLimitative - distanceInferieure) / (distanceSuperieure - distanceInferieure)) * 
        (pourcentageDistanceSuperieure - pourcentageDistanceInferieure);
    
    // Appliquer la formule spéciale pour les grandes surfaces si la distance est >= 1.2 m
    if (surfaceFacade > surfacesDisponibles[surfacesDisponibles.length - 1] && distanceLimitative >= 1.2) {
        // Pour le tableau 9.10.14.4-A avec usage "habitation" ou pour 9.10.15.4
        if (!tableau.hasOwnProperty("usages") || tableau.usages === "habitation") {
            pourcentageFinal = Math.pow(distanceLimitative, 2);
        } else { // Pour le tableau 9.10.14.4-A avec usage "commercial"
            pourcentageFinal = 0.5 * Math.pow(distanceLimitative, 2);
        }
    }
    
    // Appliquer la majoration si nécessaire (briques de verre, verre armé ou gicleurs)
    if (avecMajoration || avecGicleurs) {
        pourcentageFinal = Math.min(100, pourcentageFinal * 2);
    }
    
    // Limiter le pourcentage final entre 0 et 100
    return Math.max(0, Math.min(100, pourcentageFinal));
}

// Version spécifique pour 9.10.14
function calculerPourcentage91014(usage, distanceLimitative, surfaceFacade, avecGicleurs, avecMajoration) {
    const tableau = {
        usages: usage,
        surfaces: tableau91014[usage].surfaces,
        distances: tableau91014[usage].distances
    };
    
    return calculerPourcentage910x(tableau, distanceLimitative, surfaceFacade, avecGicleurs, avecMajoration);
}

// Version spécifique pour 9.10.15
function calculerPourcentage91015(distanceLimitative, surfaceFacade, avecGicleurs, avecMajoration) {
    return calculerPourcentage910x(tableau91015, distanceLimitative, surfaceFacade, avecGicleurs, avecMajoration);
}

function calculateCNB() {
    const facadeSurface = parseFloat(document.getElementById('surface_cnb').value);
    const length = parseFloat(document.getElementById('length_cnb').value);
    const height = parseFloat(document.getElementById('height_cnb').value);
    let limitingDistance = parseFloat(document.getElementById('distance_cnb').value);
    const sprinklersOption = document.getElementById('sprinklers_cnb').value;
    const response = document.getElementById('response_cnb').checked;
    const usage = document.getElementById('usage_cnb').value;
    const constructionType = document.getElementById('construction_type_cnb').value;
    const revetementType = document.getElementById('revetement_type_cnb').value;
    const glassBrick = document.getElementById('glass_brick_cnb').checked;
    const exemptBuilding = document.getElementById('exempt_building_cnb').value;
    const proposedArea = parseFloat(document.getElementById('proposed_area_cnb').value);
    const checkSpacing = document.getElementById('check_spacing_cnb').checked;
    const horizontalSpacing = parseFloat(document.getElementById('horizontal_spacing_cnb').value);
    const verticalSpacing = parseFloat(document.getElementById('vertical_spacing_cnb').value);
    const checkSoffit = document.getElementById('check_soffit_cnb').checked;
    const soffit_distance = parseFloat(document.getElementById('soffit_distance_cnb').value);
    const soffit_protected = document.getElementById('soffit_protected_cnb').checked;
    const weightedArea = document.getElementById('weighted_area_cnb').checked;
    const Tu = parseFloat(document.getElementById('Tu_cnb').value);
    const resistanceAuFeu = document.getElementById('resistance_cnb').value;

    // Vérification des entrées
    if (isNaN(facadeSurface) || isNaN(length) || isNaN(height) || isNaN(limitingDistance) || 
        facadeSurface <= 0 || length <= 0 || height <= 0 || limitingDistance < 0) {
        document.getElementById('cnb-result').innerHTML = "Erreur : Veuillez entrer des valeurs numériques valides.";
        return;
    }
    
    // Vérifier si le bâtiment est exempté
    if (exemptBuilding !== "none") {
        let exemptMessage = "";
        if (exemptBuilding === "parking" && limitingDistance >= 3) {
            exemptMessage = `
                <strong>Bâtiment exempté - Garage de stationnement à étages ouverts :</strong><br>
                Selon l'article 3.2.3.10. 1), les façades de rayonnement d'un garage de stationnement dont 
                tous les étages sont des étages ouverts peuvent comporter des baies non protégées sans 
                limitation de surface si la distance limitative est d'au moins 3 m.<br><br>
                <strong>Surface maximale des baies non protégées : 100%</strong>
            `;
        } else if (exemptBuilding === "street_level" && limitingDistance >= 9) {
            exemptMessage = `
                <strong>Bâtiment exempté - Façade donnant sur une rue :</strong><br>
                Selon l'article 3.2.3.10. 2), la partie de la façade de rayonnement donnant sur une rue peut 
                comporter, à l'étage qui se trouve au niveau de la rue, des baies non protégées sans 
                limitation de surface si la distance limitative est d'au moins 9 m.<br><br>
                <strong>Surface maximale des baies non protégées : 100%</strong>
            `;
        } else {
            exemptMessage = `
                <strong>Bâtiment exempté - Conditions non satisfaites :</strong><br>
                Le bâtiment que vous avez sélectionné pourrait être exempté, mais les conditions ne sont pas satisfaites.<br>
                ${exemptBuilding === "parking" ? 
                    "- Pour un garage de stationnement à étages ouverts, la distance limitative doit être d'au moins 3 m." : 
                    "- Pour une façade donnant sur une rue, la distance limitative doit être d'au moins 9 m."}
            `;
        }
        
        if (exemptMessage.includes("100%")) {
            document.getElementById('copy_cnb').style.display = 'inline-block';
            document.getElementById('cnb-result').innerHTML = exemptMessage;
            return;
        }
        // Si non exempté, on continue avec le calcul normal
    }

    // Ajustement pour le délai d'intervention
    if (response) {
        limitingDistance = limitingDistance / 2;
    }

    // Utiliser la nouvelle méthode de calcul CNB
    const avecGicleurs = sprinklersOption === "complete";
    let pourcentage = calculerPourcentageCNB(
        usage, 
        limitingDistance, 
        facadeSurface, 
        length, 
        height, 
        avecGicleurs, 
        glassBrick
    );
    
    // Appliquer la méthode de l'aire pondérée si demandée
    if (weightedArea) {
        let Te;
        if (resistanceAuFeu === "45") {
            Te = 892;
        } else if (resistanceAuFeu === "60") {
            Te = 927;
        } else { // 120
            Te = 1010;
        }
        
        // Calculer le coefficient d'ouverture équivalente FEO
        const FEO = Math.pow((Tu / Te), 4);
        
        // Calculer la surface corrigée
        const AF = facadeSurface; // Surface extérieure de la façade 
        const A = (pourcentage / 100) * facadeSurface; // Surface réelle de baies non protégées
        const AC = A + (AF - A) * FEO; // Surface corrigée
        
        // Recalculer le pourcentage
        pourcentage = (AC / facadeSurface) * 100;
        
        // Limiter le pourcentage entre 0 et 100
        pourcentage = Math.max(0, Math.min(100, pourcentage));
    }
    
    // Calculer la surface maximale de baies non protégées
    const maxArea = (pourcentage / 100) * facadeSurface;
    
    // Déterminer les exigences de construction selon 3.2.3.7
    let constructionRequirements = determineConstructionRequirements(pourcentage, usage, constructionType, revetementType);
    
    // Vérification de l'espacement des baies
    let spacingResult = "";
    if (checkSpacing) {
        const minHorizontalSpacing = 2.0; // En mètres selon 3.2.3.1.(6)
        const minVerticalSpacing = 2.0;   // En mètres selon 3.2.3.1.(6)
        
        if (horizontalSpacing < minHorizontalSpacing || verticalSpacing < minVerticalSpacing) {
            spacingResult = `
                <br><strong>Vérification de l'espacement des baies :</strong><br>
                ⚠️ <span style="color: red;">NON CONFORME</span> - L'espacement des baies ne respecte pas les exigences minimales.<br>
                Selon l'article 3.2.3.1.(6), l'espacement des baies non protégées desservant une même pièce doit être d'au moins :<br>
                - 2 m horizontalement (valeur saisie: ${horizontalSpacing} m)<br>
                - 2 m verticalement (valeur saisie: ${verticalSpacing} m)
            `;
        } else {
            spacingResult = `
                <br><strong>Vérification de l'espacement des baies :</strong><br>
                ✅ <span style="color: green;">CONFORME</span> - L'espacement des baies respecte les exigences minimales.<br>
                Espacement horizontal: ${horizontalSpacing} m (minimum requis: 2 m)<br>
                Espacement vertical: ${verticalSpacing} m (minimum requis: 2 m)
            `;
        }
    }
    
    // Vérification de la protection des soffites
    let soffitResult = "";
    if (checkSoffit) {
        if (soffit_distance < 0.45) {
            soffitResult = `
                <br><strong>Protection des soffites :</strong><br>
                Selon l'article 3.2.3.6.(2), aucun soffite ne doit faire saillie au-dessus de la façade de rayonnement
                lorsque la distance limitative est inférieure à 0,45 m.<br>
                ${soffit_distance < 0.45 ? 
                    "⚠️ <span style=\"color: red;\">La distance du soffite (" + soffit_distance + " m) est inférieure à 0,45 m. Aucun soffite n'est autorisé.</span>" : 
                    "La distance du soffite est conforme."}
            `;
        } else if (soffit_distance < 1.2) {
            soffitResult = `
                <br><strong>Protection des soffites :</strong><br>
                Selon l'article 3.2.3.6.(3-5), si la distance limitative est entre 0,45 m et 1,2 m, les soffites de toit 
                ne doivent pas faire saillie à moins de 0,45 m de la limite de propriété, ou doivent être protégés.<br>
                ${soffit_distance < 0.45 ? 
                    "⚠️ <span style=\"color: red;\">La distance du soffite (" + soffit_distance + " m) est inférieure à 0,45 m. Une protection est requise.</span>" : 
                    "La distance du soffite est d'au moins 0,45 m."}
                ${!soffit_protected && soffit_distance < 0.45 ? 
                    "<br>⚠️ <span style=\"color: green;\">Le soffite est protégé selon les exigences.</span>" : ""}
            `;
        } else {
            soffitResult = `
                <br><strong>Protection des soffites :</strong><br>
                ✅ <span style="color: green;">La distance du soffite (${soffit_distance} m) est supérieure à 1,2 m. 
                Aucune protection spécifique n'est requise.</span>
            `;
        }
    }

   // Afficher les résultats détaillés avec les calculs intermédiaires
   // La partie d'affichage reste la même
   let resultHTML = `
   <strong>Données de calcul :</strong><br>
   ${response ? "Distance limitative ajustée : " + limitingDistance.toFixed(2) + " m<br>" : ""}
   Rapport L/H ou H/L : ${determinerRapportLH(length, height)}<br>
   Type de construction : ${constructionType}<br>
   Type de revêtement : ${revetementType}<br>
   Protection par gicleurs : ${sprinklersOption === "complete" ? "Complète" : sprinklersOption === "partial" ? "Partielle" : "Aucune"}<br>
   ${glassBrick ? "Majoration pour briques de verre/verre armé appliquée (x2)<br>" : ""}
   ${weightedArea ? "Méthode de l'aire pondérée appliquée (Température: " + Tu + "°C, Résistance au feu: " + resistanceAuFeu + " min)<br>" : ""}
   <br><strong>Résultats :</strong><br>
   Pourcentage maximal de baies non protégées : ${pourcentage.toFixed(2)}%<br>
   Surface maximale de baies non protégées : ${maxArea.toFixed(2)} m²
   ${constructionRequirements}
   ${spacingResult}
   ${soffitResult}
`;

    // Ajouter la comparaison avec la surface proposée
    if (!isNaN(proposedArea) && proposedArea > 0) {
        const proposedPercentage = (proposedArea / facadeSurface) * 100;
        let statusClass = "";
        let comparisonResult = "";
        
        if (proposedPercentage > pourcentage) {
            statusClass = "color: red; font-weight: bold;";
            comparisonResult = `
                <br><br><strong>Comparaison avec la surface proposée:</strong><br>
                Votre proposition: ${proposedArea.toFixed(2)} m² (${proposedPercentage.toFixed(2)}% de la façade)<br>
                <span style="${statusClass}">⚠️ NON CONFORME: La surface proposée dépasse le maximum autorisé de ${maxArea.toFixed(2)} m² (${pourcentage.toFixed(2)}%).</span>
            `;
        } else {
            statusClass = "color: green; font-weight: bold;";
            comparisonResult = `
                <br><br><strong>Comparaison avec la surface proposée:</strong><br>
                Votre proposition: ${proposedArea.toFixed(2)} m² (${proposedPercentage.toFixed(2)}% de la façade)<br>
                <span style="${statusClass}">✅ CONFORME: La surface proposée respecte le maximum autorisé de ${maxArea.toFixed(2)} m² (${pourcentage.toFixed(2)}%).</span>
            `;
        }
        
        // Ajouter le résultat de comparaison à resultHTML
        resultHTML += comparisonResult;
    }
    
    // Ajouter le message de dégagement de responsabilité
    resultHTML += `
    <br><br><div style="font-style: italic; padding: 10px; border-top: 1px solid #ccc; margin-top: 10px;">
    <strong>Avis de non-responsabilité:</strong> Les résultats générés par cet outil sont fournis à titre indicatif uniquement. 
    L'utilisateur demeure responsable de valider leur conformité auprès d'un professionnel qualifié ou de l'autorité compétente en matière de sécurité incendie.
    </div>
`;           
    document.getElementById('cnb-result').innerHTML = resultHTML;
    document.getElementById('copy_cnb').style.display = 'inline-block';
}

function determineConstructionRequirements(percentage, usage, constructionType, revetementType) {
    // Déterminer le degré de résistance au feu et les exigences de construction selon 3.2.3.7
    let degre = "";
    let constructionExigence = "";
    let revetementExigence = "";
    
    if (percentage <= 10) {
        if (usage === "groupes_A_B3_C_D_F3") {
            degre = "1 h";
        } else { // groupes_E_F1_F2
            degre = "2 h";
        }
        constructionExigence = "Incombustible";
        revetementExigence = "Incombustible";
    } else if (percentage <= 25) {
        if (usage === "groupes_A_B3_C_D_F3") {
            degre = "1 h";
        } else { // groupes_E_F1_F2
            degre = "2 h";
        }
        constructionExigence = "Combustible ou incombustible";
        revetementExigence = "Incombustible";
     } else if (percentage <= 50) {
        if (usage === "groupes_A_B3_C_D_F3") {
            degre = "45 min";
        } else { // groupes_E_F1_F2
            degre = "1 h";
        }
        constructionExigence = "Combustible ou incombustible";
        revetementExigence = "Incombustible";
    } else if (percentage < 100) {
        if (usage === "groupes_A_B3_C_D_F3") {
            degre = "45 min";
        } else { // groupes_E_F1_F2
            degre = "1 h";
        }
        constructionExigence = "Combustible ou incombustible";
        revetementExigence = "Combustible ou incombustible";
    }
    
    // Si la construction actuelle n'est pas conforme, ajouter un avertissement
    let warningMsg = "";
    if ((constructionExigence === "Incombustible" && constructionType === "combustible") ||
        (revetementExigence === "Incombustible" && revetementType === "combustible")) {
        warningMsg = "<br>⚠️ <strong>Attention :</strong> La construction ou le revêtement sélectionné ne respecte pas les exigences minimales du tableau 3.2.3.7.";
    }
    
    return `
        <br><strong>Exigences de construction (tableau 3.2.3.7):</strong><br>
        Pour ${percentage.toFixed(2)}% de baies non protégées:<br>
        - Degré de résistance au feu minimal: ${degre}<br>
        - Type de construction exigé: ${constructionExigence}<br>
        - Type de revêtement exigé: ${revetementExigence}${warningMsg}
    `;
}

function calculate91014() {
    const usage = document.getElementById('usage_91014').value;
    const buildingType = document.getElementById('building_type_91014').value;
    const exteriorFinish = document.getElementById('exterior_finish_91014').value;
    const sprinklersOption = document.getElementById('sprinklers_91014').value;
    const glassBrick = document.getElementById('glass_brick_91014').checked;
    let limitingDistance = parseFloat(document.getElementById('distance_91014').value);
    const surface = parseFloat(document.getElementById('surface_91014').value);
    const response = document.getElementById('response_91014').checked;
    const proposedArea = parseFloat(document.getElementById('proposed_area_91014').value);
    let checkSpacing = document.getElementById('check_spacing_91014').checked;
    const horizontalSpacing = parseFloat(document.getElementById('horizontal_spacing_91014').value);
    const verticalSpacing = parseFloat(document.getElementById('vertical_spacing_91014').value);
    const checkSoffit = document.getElementById('check_soffit_91014').checked;
    const soffit_distance = parseFloat(document.getElementById('soffit_distance_91014').value);
    const soffit_protected = document.getElementById('soffit_protected_91014').checked;
    const distinction = document.getElementById('distinction_91014').value;

    // Vérification des entrées
    if (isNaN(limitingDistance) || isNaN(surface) || limitingDistance < 0 || surface <= 0) {
        document.getElementById('method91014-result').innerHTML = "Erreur : Veuillez entrer des valeurs numériques valides.";
        return;
    }

    // Ajustement pour le délai d'intervention
    if (response) {
        limitingDistance = limitingDistance / 2;
    }
    
    // Exemption pour les garages ou bâtiments secondaires
    if (buildingType === "garage") {
        // Selon 9.10.14.4.(10-12), les baies vitrées des garages peuvent être exemptées des restrictions
         document.getElementById('method91014-result').innerHTML = `
             <strong>Résultat pour garage ou bâtiment secondaire :</strong><br>
             Selon les paragraphes 9.10.14.4.(10-12) et 9.10.14.5.(4-5), les garages et bâtiments secondaires 
             qui ne desservent qu'un seul logement peuvent bénéficier d'exemptions importantes:<br><br>
             
             - Si le garage dessert un seul logement et est sur la même propriété: 
               <strong>pas de limite de surface pour les baies vitrées</strong><br>
             - Pour la construction de la façade de rayonnement, si la distance limitative est d'au moins 0,6 m:
               <strong>pas d'exigence quant au degré de résistance au feu</strong><br>
             - Si la distance limitative est inférieure à 0,6 m: <strong>un degré de résistance au feu d'au moins 
               45 min est requis</strong><br>
             - <strong>Aucune exigence quant au type de revêtement</strong>, peu importe la distance limitative<br><br>
             
             Pour une analyse plus spécifique, veuillez sélectionner "Bâtiment standard" dans le type de bâtiment.
         `;
         document.getElementById('copy_91014').style.display = 'inline-block';
         return;
     }

    // Si la distance limitative est d'au plus 2 m, activer automatiquement la vérification d'espacement
    if (limitingDistance <= 2.0) {
        // Activer la case à cocher et afficher les options d'espacement
        document.getElementById('check_spacing_91014').checked = true;
        document.getElementById('spacing_options_91014').style.display = 'block';
        checkSpacing = true; // S'assurer que la vérification sera effectuée
    }

    // Utiliser la nouvelle méthode de calcul 9.10.14
    const avecGicleurs = sprinklersOption === "complete";
    const pourcentage = calculerPourcentage91014(
        usage, 
        limitingDistance, 
        surface, 
        avecGicleurs, 
        glassBrick
    );
    
    // Calculer la surface maximale
    const maxArea = (pourcentage / 100) * surface;

    // Déterminer les exigences de construction et de protection
    let constructionRequirements = "";

    if (limitingDistance < 1.2) {
        constructionRequirements = `
            <br><strong>Exigences pour distance limitative < 1,2 m (9.10.14.4.2):</strong><br>
            - Les ouvertures doivent être protégées par des dispositifs d'obturation<br>
            - Le verre armé et les briques de verre ne sont pas autorisés<br>
            - ${exteriorFinish === "incombustible" ? 
                "Revêtement incombustible requis pour les façades" : 
                "Revêtement combustible soumis à des restrictions importantes (voir 9.10.14.5)"}
        `;
    }

    // Vérification de l'espacement des baies
    let spacingResult = "";
    if (checkSpacing) {
        const minHorizontalSpacing = 2.0; // En mètres selon 9.10.14.4.(4)
        const minVerticalSpacing = 2.0;   // En mètres selon 9.10.14.4.(4)
        
        if (limitingDistance <= 2.0) {
            // Calcul de la surface maximale de chaque baie selon 9.10.14.4.(3)
            let maxBaieArea = 0;
            let maxBaieInfo = "";
            let formulaArea = 0;
            
            if (limitingDistance < 1.2) {
                maxBaieArea = 0.35;
                maxBaieInfo = `Selon le tableau 9.10.14.4.-B, pour une distance limitative < 1,2 m, chaque baie ne doit pas dépasser 0,35 m².`;
            } else if (limitingDistance <= 1.5) {
                maxBaieArea = 0.78;
                formulaArea = Math.pow(limitingDistance, 2);
                
                if (formulaArea > maxBaieArea) {
                    maxBaieInfo = `Selon la formule du paragraphe 9.10.14.4.(3)b), chaque baie ne doit pas dépasser ${formulaArea.toFixed(2)} m² (méthode alternative selon le tableau 9.10.14.4.-B: ${maxBaieArea.toFixed(2)} m²).`;
                } else {
                    maxBaieInfo = `Selon le tableau 9.10.14.4.-B, chaque baie ne doit pas dépasser ${maxBaieArea.toFixed(2)} m² (méthode alternative selon la formule du paragraphe 9.10.14.4.(3)b): ${formulaArea.toFixed(2)} m²).`;
                }
            } else if (limitingDistance <= 2.0) {
                maxBaieArea = 1.88;
                formulaArea = Math.pow(limitingDistance, 2);
                
                if (formulaArea > maxBaieArea) {
                    maxBaieInfo = `Selon la formule du paragraphe 9.10.14.4.(3)b), chaque baie ne doit pas dépasser ${formulaArea.toFixed(2)} m² (méthode alternative selon le tableau 9.10.14.4.-B: ${maxBaieArea.toFixed(2)} m²).`;
                } else {
                    maxBaieInfo = `Selon le tableau 9.10.14.4.-B, chaque baie ne doit pas dépasser ${maxBaieArea.toFixed(2)} m² (méthode alternative selon la formule du paragraphe 9.10.14.4.(3)b): ${formulaArea.toFixed(2)} m²).`;
                }
            }
            
            spacingResult = `
                <br><strong>Vérification de l'espacement des baies :</strong><br>
                <strong>Restrictions selon 9.10.14.4.(3) :</strong><br>
                ${maxBaieInfo}<br>
            `;
            
            // Vérification de l'espacement
            if (horizontalSpacing < minHorizontalSpacing || verticalSpacing < minVerticalSpacing) {
                spacingResult += `
                    <strong>Espacement des baies :</strong><br>
                    ⚠️ <span style="color: red;">NON CONFORME</span> - L'espacement des baies ne respecte pas les exigences minimales.<br>
                    Selon l'article 9.10.14.4.(4), l'espacement des baies non protégées desservant une même pièce doit être d'au moins :<br>
                    - 2 m horizontalement (valeur saisie: ${horizontalSpacing} m)<br>
                    - 2 m verticalement (valeur saisie: ${verticalSpacing} m)
                `;
            } else {
                spacingResult += `
                    <strong>Espacement des baies :</strong><br>
                    ✅ <span style="color: green;">CONFORME</span> - L'espacement des baies respecte les exigences minimales.<br>
                    Espacement horizontal: ${horizontalSpacing} m (minimum requis: 2 m)<br>
                    Espacement vertical: ${verticalSpacing} m (minimum requis: 2 m)
                `;
            }
        } else {
            // Pour les distances > 2.0 m, indiquer que les restrictions ne s'appliquent pas
            spacingResult = `
                <br><strong>Vérification de l'espacement des baies :</strong><br>
                ✅ <span style="color: green;">NON APPLICABLE</span> - Les restrictions d'espacement et de taille des baies 
                prévues aux paragraphes 9.10.14.4.(3) et (4) ne s'appliquent que si la distance limitative est d'au plus 2 m.<br>
                Avec une distance limitative de ${limitingDistance.toFixed(2)} m > 2 m, ces restrictions ne s'appliquent pas.
            `;
        }
    }
     
     // Vérification de la protection des soffites
     let soffitResult = "";
     if (checkSoffit) {
         if (soffit_distance < 0.45) {
             soffitResult = `
                 <br><strong>Protection des soffites :</strong><br>
                 Selon l'article 9.10.14.5.(9), aucun soffite ne doit faire saillie au-dessus de la façade de rayonnement
                 lorsque la distance limitative est inférieure à 0,45 m.<br>
                 ${soffit_distance < 0.45 ? 
                     "⚠️ <span style=\"color: red;\">La distance du soffite (" + soffit_distance + " m) est inférieure à 0,45 m. Aucun soffite n'est autorisé.</span>" : 
                     "La distance du soffite est conforme."}
             `;
         } else if (soffit_distance < 1.2) {
             soffitResult = `
                 <br><strong>Protection des soffites :</strong><br>
                 Selon l'article 9.10.14.5.(10-12), si la distance limitative est entre 0,45 m et 1,2 m, les soffites de toit 
                 ne doivent pas faire saillie à moins de 0,45 m de la limite de propriété, ou doivent être protégés.<br>
                 ${soffit_distance < 0.45 ? 
                     "⚠️ <span style=\"color: red;\">La distance du soffite (" + soffit_distance + " m) est inférieure à 0,45 m. Une protection est requise.</span>" : 
                     "La distance du soffite est d'au moins 0,45 m."}
                 ${!soffit_protected && soffit_distance < 1.2 ? 
                     "<br>⚠️ <span style=\"color: red;\">Le soffite n'est pas protégé selon les exigences.</span>" : 
                     soffit_protected ? "<br>✅ <span style=\"color: green;\">Le soffite est protégé selon les exigences.</span>" : ""}
             `;
         } else {
             soffitResult = `
                 <br><strong>Protection des soffites :</strong><br>
                 ✅ <span style="color: green;">La distance du soffite (${soffit_distance} m) est supérieure à 1,2 m. 
                 Aucune protection spécifique n'est requise.</span>
             `;
         }
     }
     
     // Distinction entre baies vitrées et baies non protégées
     let distinctionInfo = "";
     if (distinction === "glazed") {
         distinctionInfo = `
             <br><strong>Type de baies :</strong><br>
             <i>Vous avez spécifié des baies vitrées. En vertu de 9.10.14, les baies vitrées sont une catégorie 
             spécifique de baies non protégées. Les baies vitrées sont soumises aux mêmes restrictions de 
             surface que les baies non protégées, mais peuvent avoir des exigences différentes en matière de 
             construction et de protection.</i>
         `;
     }

     // Afficher les résultats (la partie d'affichage reste la même)
     let resultHTML = `
          <strong>Données de calcul :</strong><br>
          ${response ? "Distance limitative ajustée : " + limitingDistance.toFixed(2) + " m<br>" : ""}
          Type d'usage : ${usage === "habitation" ? "Habitation, établissement d'affaires et établissement industriel à risques faibles" : "Établissement commercial et établissement industriel à risques moyens"}<br>
          Surface totale de la façade : ${surface.toFixed(2)} m²<br>
          Protection par gicleurs : ${sprinklersOption === "complete" ? "Complète" : sprinklersOption === "partial" ? "Partielle" : "Aucune"}<br>
          ${glassBrick ? "Majoration pour briques de verre/verre armé appliquée (x2)<br>" : ""}
          <br><strong>Résultats :</strong><br>
          Pourcentage maximal de baies non protégées : ${pourcentage.toFixed(2)}%<br>
          Surface maximale de baies non protégées : ${maxArea.toFixed(2)} m²
          ${constructionRequirements}
          ${spacingResult}
          ${soffitResult}
          ${distinctionInfo}
      `;
     
     // Ajouter la comparaison avec la surface proposée si existe
     if (!isNaN(proposedArea) && proposedArea > 0) {
         const proposedPercentage = (proposedArea / surface) * 100;
         let statusClass = "";
         let comparisonResult = "";
         
         if (proposedPercentage > pourcentage) {
             statusClass = "color: red; font-weight: bold;";
             comparisonResult = `
                 <br><br><strong>Comparaison avec la surface proposée:</strong><br>
                 Votre proposition: ${proposedArea.toFixed(2)} m² (${proposedPercentage.toFixed(2)}% de la façade)<br>
                 <span style="${statusClass}">⚠️ NON CONFORME: La surface proposée dépasse le maximum autorisé de ${maxArea.toFixed(2)} m² (${pourcentage.toFixed(2)}%).</span>
             `;
         } else {
             statusClass = "color: green; font-weight: bold;";
             comparisonResult = `
                 <br><br><strong>Comparaison avec la surface proposée:</strong><br>
                 Votre proposition: ${proposedArea.toFixed(2)} m² (${proposedPercentage.toFixed(2)}% de la façade)<br>
                 <span style="${statusClass}">✅ CONFORME: La surface proposée respecte le maximum autorisé de ${maxArea.toFixed(2)} m² (${pourcentage.toFixed(2)}%).</span>
             `;
         }
         
         // Ajouter le résultat de comparaison à resultHTML
         resultHTML += comparisonResult;
     }
     
     // Ajouter le message de dégagement de responsabilité
     resultHTML += `
     <br><br><div style="font-style: italic; padding: 10px; border-top: 1px solid #ccc; margin-top: 10px;">
     <strong>Avis de non-responsabilité:</strong> Les résultats générés par cet outil sont fournis à titre indicatif uniquement. 
     L'utilisateur demeure responsable de valider leur conformité auprès d'un professionnel qualifié ou de l'autorité compétente en matière de sécurité incendie.
     </div>
`;           
     document.getElementById('method91014-result').innerHTML = resultHTML;
     document.getElementById('copy_91014').style.display = 'inline-block';
}

function calculate91015() {
    const sprinklersOption = document.getElementById('sprinklers_91015').value;
    const glassBrick = document.getElementById('glass_brick_91015').checked;
    let limitingDistance = parseFloat(document.getElementById('distance_91015').value);
    const surface = parseFloat(document.getElementById('surface_91015').value);
    const response = document.getElementById('response_91015').checked;
    const housingType = document.getElementById('housing_type_91015').value;
    const revetingType = document.getElementById('reveting_type_91015').value;
    const proposedArea = parseFloat(document.getElementById('proposed_area_91015').value);
    const checkSpacing = document.getElementById('check_spacing_91015').checked;
    const horizontalSpacing = parseFloat(document.getElementById('horizontal_spacing_91015').value);
    const verticalSpacing = parseFloat(document.getElementById('vertical_spacing_91015').value);
    const checkSoffit = document.getElementById('check_soffit_91015').checked;
    const soffit_distance = parseFloat(document.getElementById('soffit_distance_91015').value);
    const soffit_protected = document.getElementById('soffit_protected_91015').checked;
    const distinction = document.getElementById('distinction_91015').value;

    // Vérification des entrées
    if (isNaN(limitingDistance) || isNaN(surface) || limitingDistance < 0 || surface <= 0) {
        document.getElementById('method91015-result').innerHTML = "Erreur : Veuillez entrer des valeurs numériques valides.";
        return;
    }

    // Ajustement pour le délai d'intervention
    if (response) {
        limitingDistance = limitingDistance / 2;
    }

    // Utiliser la nouvelle méthode de calcul 9.10.15
    const avecGicleurs = sprinklersOption === "complete";
    const pourcentage = calculerPourcentage91015(
        limitingDistance, 
        surface, 
        avecGicleurs, 
        glassBrick
    );
    
    // Calculer la surface maximale
    const maxArea = (pourcentage / 100) * surface;
    
    // Déterminer les exigences de construction
    let constructionRequirements = "";
    if (limitingDistance < 0.6) {
        constructionRequirements = `
            <br><strong>Exigences de construction (selon 9.10.15.5):</strong><br>
            - Degré de résistance au feu d'au moins 45 min pour la façade de rayonnement<br>
            - Revêtement extérieur ${revetingType === "incombustible" ? "incombustible" : "combustible avec contraintes"}<br>
            ${revetingType === "combustible" ? 
            `- Le revêtement combustible doit être installé selon l'article 9.10.15.5, paragraphe 2):<br>
               &nbsp;&nbsp;• Posé sur revêtement en plaques de plâtre d'au moins 12,7 mm ou maçonnerie<br>
               &nbsp;&nbsp;• Doit avoir un indice de propagation de la flamme d'au plus 25<br>
               &nbsp;&nbsp;• Si c'est un revêtement conforme à 9.27.12, son épaisseur ne doit pas dépasser 2 mm<br>
               &nbsp;&nbsp;• Peut aussi être conforme à l'alinéa 3.1.5.5.1)b)`
             : ""}
        `;
    } else if (limitingDistance < 1.2) {
        constructionRequirements = `
            <br><strong>Exigences de construction (selon 9.10.15.5):</strong><br>
            - Degré de résistance au feu d'au moins 45 min pour la façade de rayonnement<br>
            ${revetingType === "combustible" ? 
            `- Revêtement combustible soumis aux exigences du paragraphe 3) de l'article 9.10.15.5:<br>
               &nbsp;&nbsp;• Si conforme à 9.27.6, 9.27.7, 9.27.8, 9.27.9 ou 9.27.10:<br>
               &nbsp;&nbsp;&nbsp;&nbsp;- Posé sur revêtement en plaques de plâtre d'au moins 12,7 mm ou maçonnerie<br>
               &nbsp;&nbsp;&nbsp;&nbsp;- Doit avoir un indice de propagation de la flamme d'au plus 25 après conditionnement<br>
               &nbsp;&nbsp;• Si conforme à 9.27.12:<br>
               &nbsp;&nbsp;&nbsp;&nbsp;- Posé sur revêtement en plaques de plâtre d'au moins 12,7 mm ou maçonnerie<br>
               &nbsp;&nbsp;&nbsp;&nbsp;- Doit avoir un indice de propagation de la flamme d'au plus 25<br>
               &nbsp;&nbsp;&nbsp;&nbsp;- Ne doit pas dépasser 2 mm d'épaisseur<br>
               &nbsp;&nbsp;• Peut aussi être conforme à l'alinéa 3.1.5.5.1)b)`
             : "- Revêtement incombustible selon la section 9.20, la sous-section 9.27.11 ou la section 9.28"}
        `;
    } else {
        constructionRequirements = `
            <br><strong>Exigences de construction (selon 9.10.15.5):</strong><br>
            - Pour distance limitative ≥ 1,2 m: les restrictions sont moins sévères<br>
            - Les exigences minimales pour les soffites s'appliquent quand ils font saillie à moins de 1,2 m de la limite de propriété<br>
            - Pour les poteaux en gros bois d'œuvre: pas de conformité nécessaire si distance ≥ 3 m
        `;
    }
    
    // Vérification de l'espacement des baies
    let spacingResult = "";
    if (checkSpacing) {
        const minHorizontalSpacing = 2.0; // En mètres selon 9.10.15.4.(4)
        const minVerticalSpacing = 2.0;   // En mètres selon 9.10.15.4.(4)
        
        if (limitingDistance <= 2.0) {
            if (horizontalSpacing < minHorizontalSpacing || verticalSpacing < minVerticalSpacing) {
                spacingResult = `
                    <br><strong>Vérification de l'espacement des baies :</strong><br>
                    ⚠️ <span style="color: red;">NON CONFORME</span> - L'espacement des baies ne respecte pas les exigences minimales.<br>
                    Selon l'article 9.10.15.4.(4), l'espacement des baies vitrées desservant une même pièce doit être d'au moins :<br>
                    - 2 m horizontalement (valeur saisie: ${horizontalSpacing} m)<br>
                    - 2 m verticalement (valeur saisie: ${verticalSpacing} m)
                `;
            } else {
                spacingResult = `
                    <br><strong>Vérification de l'espacement des baies :</strong><br>
                    ✅ <span style="color: green;">CONFORME</span> - L'espacement des baies respecte les exigences minimales.<br>
                    Espacement horizontal: ${horizontalSpacing} m (minimum requis: 2 m)<br>
                    Espacement vertical: ${verticalSpacing} m (minimum requis: 2 m)
                `;
            }
        } else {
            // Pour les distances > 2.0 m, indiquer que les restrictions ne s'appliquent pas
            spacingResult = `
                <br><strong>Vérification de l'espacement des baies :</strong><br>
                ✅ <span style="color: green;">NON APPLICABLE</span> - Les restrictions d'espacement et de taille des baies 
                prévues aux paragraphes 9.10.15.4.(3) et (4) ne s'appliquent que si la distance limitative est d'au plus 2 m.<br>
                Avec une distance limitative de ${limitingDistance.toFixed(2)} m > 2 m, ces restrictions ne s'appliquent pas.
            `;
        }
    }
    
    // Vérification de la protection des soffites
    let soffitResult = "";
    if (checkSoffit) {
        if (soffit_distance < 0.45) {
            soffitResult = `
                <br><strong>Protection des soffites :</strong><br>
                Selon l'article 9.10.15.5.(8), aucun soffite ne doit faire saillie au-dessus de la façade de rayonnement
                lorsque la distance limitative est inférieure à 0,45 m.<br>
                ${soffit_distance < 0.45 ? 
                    "⚠️ <span style=\"color: red;\">La distance du soffite (" + soffit_distance + " m) est inférieure à 0,45 m. Aucun soffite n'est autorisé.</span>" : 
                    "La distance du soffite est conforme."}
            `;
        } else if (soffit_distance < 1.2) {
            soffitResult = `
                <br><strong>Protection des soffites :</strong><br>
                Selon l'article 9.10.15.5.(9-11), si la distance limitative est entre 0,45 m et 1,2 m, les soffites de toit 
                ne doivent pas faire saillie à moins de 0,45 m de la limite de propriété, ou doivent être protégés.<br>
                ${soffit_distance < 0.45 ? 
                    "⚠️ <span style=\"color: red;\">La distance du soffite (" + soffit_distance + " m) est inférieure à 0,45 m. Une protection est requise.</span>" : 
                    "La distance du soffite est d'au moins 0,45 m."}
                ${!soffit_protected && soffit_distance < 1.2 ? 
                    "<br>⚠️ <span style=\"color: red;\">Le soffite n'est pas protégé selon les exigences.</span>" : 
                    soffit_protected ? "<br>✅ <span style=\"color: green;\">Le soffite est protégé selon les exigences.</span>" : ""}
            `;
        } else {
            soffitResult = `
               <br><strong>Protection des soffites :</strong><br>
               ✅ <span style="color: green;">La distance du soffite (${soffit_distance} m) est supérieure à 1,2 m. 
               Aucune protection spécifique n'est requise.</span>
           `;
       }
   }
   
   // Ajouter des informations spécifiques au type d'habitation
   let housingInfo = "";
   if (housingType === "accessoire") {
       housingInfo = `
           <br><strong>Remarque pour logement accessoire:</strong><br>
           - Les maisons comportant un logement accessoire peuvent avoir des exigences supplémentaires.<br>
           - Vérifier également les exigences de l'article 9.10.15.5 pour les revêtements.<br>
       `;
   }
   
   // Distinction entre baies vitrées et baies non protégées
   let distinctionInfo = "";
   if (distinction === "glazed") {
       distinctionInfo = `
           <br><strong>Type de baies :</strong><br>
           <i>Vous avez spécifié des baies vitrées. La sous-section 9.10.15 fait spécifiquement référence 
           aux baies vitrées, qui sont une catégorie de baies non protégées. La distinction est importante 
           car certaines exigences peuvent varier.</i>
       `;
   }

   // Afficher les résultats (la partie d'affichage reste la même)
   let resultHTML = `
       <strong>Données de calcul :</strong><br>
       ${response ? "Distance limitative ajustée : " + limitingDistance.toFixed(2) + " m<br>" : ""}
       Surface totale de la façade : ${surface.toFixed(2)} m²<br>
       Type d'habitation : ${housingType === "standard" ? "Habitation standard" : "Maison comportant un logement accessoire"}<br>
       Type de revêtement : ${revetingType === "combustible" ? "Combustible" : "Incombustible"}<br>
       Protection par gicleurs : ${sprinklersOption === "complete" ? "Complète" : sprinklersOption === "partial" ? "Partielle" : "Aucune"}<br>
       ${glassBrick ? "Majoration pour briques de verre/verre armé appliquée (x2)<br>" : ""}
       <br><strong>Résultats :</strong><br>
       Pourcentage maximal de baies non protégées : ${pourcentage.toFixed(2)}%<br>
       Surface maximale de baies non protégées : ${maxArea.toFixed(2)} m²
       ${constructionRequirements}
       ${spacingResult}
       ${soffitResult}
       ${housingInfo}
       ${distinctionInfo}
   `;

   // Ajouter la comparaison avec la surface proposée si existe
   if (!isNaN(proposedArea) && proposedArea > 0) {
       const proposedPercentage = (proposedArea / surface) * 100;
       let statusClass = "";
       let comparisonResult = "";
       
       if (proposedPercentage > pourcentage) {
           statusClass = "color: red; font-weight: bold;";
           comparisonResult = `
               <br><br><strong>Comparaison avec la surface proposée:</strong><br>
               Votre proposition: ${proposedArea.toFixed(2)} m² (${proposedPercentage.toFixed(2)}% de la façade)<br>
               <span style="${statusClass}">⚠️ NON CONFORME: La surface proposée dépasse le maximum autorisé de ${maxArea.toFixed(2)} m² (${pourcentage.toFixed(2)}%).</span>
           `;
       } else {
           statusClass = "color: green; font-weight: bold;";
           comparisonResult = `
               <br><br><strong>Comparaison avec la surface proposée:</strong><br>
               Votre proposition: ${proposedArea.toFixed(2)} m² (${proposedPercentage.toFixed(2)}% de la façade)<br>
               <span style="${statusClass}">✅ CONFORME: La surface proposée respecte le maximum autorisé de ${maxArea.toFixed(2)} m² (${pourcentage.toFixed(2)}%).</span>
           `;
       }
       
       // Ajouter le résultat de comparaison à resultHTML
       resultHTML += comparisonResult;
   }
   
   // Ajouter le message de dégagement de responsabilité
   resultHTML += `
   <br><br><div style="font-style: italic; padding: 10px; border-top: 1px solid #ccc; margin-top: 10px;">
   <strong>Avis de non-responsabilité:</strong> Les résultats générés par cet outil sont fournis à titre indicatif uniquement. 
   L'utilisateur demeure responsable de valider leur conformité auprès d'un professionnel qualifié ou de l'autorité compétente en matière de sécurité incendie.
   </div>
`;
   
   document.getElementById('method91015-result').innerHTML = resultHTML;
   document.getElementById('copy_91015').style.display = 'inline-block';
}

function openTab(event, tabName) {
    var tabcontent = document.getElementsByClassName("tab-content");
    for (var i = 0; i < tabcontent.length; i++) {
        tabcontent[i].classList.remove("active");
    }
    var tablinks = document.getElementsByClassName("tab-link");
    for (var i = 0; i < tablinks.length; i++) {
        tablinks[i].classList.remove("active");
    }
    document.getElementById(tabName).classList.add("active");
    event.currentTarget.classList.add("active");
}

// Fonction pour copier le contenu dans le presse-papier
function copyToClipboard(elementId) {
    const element = document.getElementById(elementId);
    const text = element.innerText;
    
    navigator.clipboard.writeText(text)
        .then(() => {
            // Pour "method91014-result" ou "method91015-result", extrait "91014" ou "91015"
            let buttonId;
            if (elementId.startsWith('method')) {
                buttonId = elementId.split('-')[0].replace('method', '');
            } else {
                buttonId = elementId.split('-')[0];
            }
            
            const originalButtonText = document.getElementById(`copy_${buttonId}`).innerHTML;
            document.getElementById(`copy_${buttonId}`).innerHTML = "✓ Copié!";
            setTimeout(() => {
                document.getElementById(`copy_${buttonId}`).innerHTML = originalButtonText;
            }, 2000);
        })
        .catch(err => {
            console.error('Impossible de copier le texte:', err);
        });
}

// Fonction pour gérer l'appui sur la touche Enter
function handleEnterKey(event, calculationFunction) {
    if (event.key === "Enter") {
        calculationFunction();
    }
}
